!function(e){function t(r){if(a[r])return a[r].exports;var n=a[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var a={};return t.m=e,t.c=a,t.i=function(e){return e},t.d=function(e,a,r){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=70)}([function(e,t,a){"use strict";angular.module("argus.config",[]).config(["$routeProvider","$httpProvider","growlProvider","paginationTemplateProvider","$analyticsProvider",function(e,t,a,r,n){t.defaults.withCredentials=!0,t.interceptors.push("UnauthorizedInterceptor"),r.setPath("bower_components/angular-utils-pagination/dirPagination.tpl.html"),e.when("/viewmetrics",{templateUrl:"js/templates/viewmetrics.html",controller:"ViewMetrics",label:"Metrics",activeTab:"metrics",reloadOnSearch:!1}).when("/batches",{templateUrl:"js/templates/batches.html",controller:"BatchExpressions",activeTab:"batches"}).when("/dashboards",{templateUrl:"js/templates/dashboard-list.html",controller:"Dashboards",label:"Dashboard List",activeTab:"dashboards"}).when("/dashboards/:dashboardId",{templateUrl:"js/templates/dashboard-detail.html",controller:"DashboardsDetail",label:"{{dashboards.dashboardId}}",activeTab:"dashboards",reloadOnSearch:!1}).when("/alerts",{templateUrl:"js/templates/alert-list.html",controller:"Alerts",label:"Alerts List",activeTab:"alerts"}).when("/alerts/:alertId",{templateUrl:"js/templates/alert-detail.html",controller:"AlertsDetail",label:"{{alerts.alertId}}",activeTab:"alerts"}).when("/about",{templateUrl:"js/templates/about.html",controller:"About",label:"About Argus",activeTab:"about"}).when("/admin",{templateUrl:"js/templates/admin.html",controller:"Admin",activeTab:"admin"}).when("/login",{templateUrl:"js/templates/login.html",controller:"Login",label:"User Login",activeTab:""}).when("/namespace",{templateUrl:"js/templates/namespace.html",controller:"Namespace",label:"Namespace",activeTab:"namespace"}).otherwise({redirectTo:"/dashboards"}),a.onlyUniqueMessages(!1),a.globalDisableCloseButton(!0),a.globalDisableCountDown(!0),a.globalPosition("top-center"),a.globalDisableIcons(!0),a.globalTimeToLive(3e3),n.firstPageview(!0),n.withAutoBase(!0)}]).run(["CONFIG","$rootScope","$location","$route","Auth","growl",function(e,t,a,r,n,i){t.$on("$locationChangeStart",function(e,t,s){var o=n.isLoggedIn(),l=n.getTarget(),c=a.path();o?"/login"===c?(e.preventDefault(),n.setTarget(null),a.path(null===l?"/dashboards":l)):n.setTarget(c):o||"/login"===c?angular.isDefined(s)||(e.preventDefault(),r.reload()):(console.log("DENY"),i.error("You are not logged in."),e.preventDefault(),n.setTarget(c),a.path("/login"))})}])},function(e,t){angular.module("argus.urlConfig",[]).constant("CONFIG",{version:"2.4.0-SNAPSHOT",wsUrl:"https://argus-ws.data.sfdc.net:443/argusws/",emailUrl:"https://mail.google.com/mail/?view=cm&fs=1&tf=1&to=argus-dev@salesforce.com",feedUrl:"https://groups.google.com/a/salesforce.com/forum/?hl=en#!forum/argus-user",wikiUrl:"https://github.com/salesforce/Argus/wiki",issueUrl:"https://groups.google.com/a/salesforce.com/forum/?hl=en#!forum/argus-dev",templatePath:""})},function(e,t,a){"use strict";angular.module("argus.controllers.about",[]).controller("About",["$scope","CONFIG",function(e,t){e.config=t}])},function(e,t,a){"use strict";angular.module("argus.controllers.admin",["ngResource"]).controller("Admin",["$scope","CONFIG","Auth","growl","ReinstateUser",function(e,t,a,r,n){e.config=t,e.isPrivileged=a.isPrivileged(),e.submitUser=function(){if(""!==e.username&&""!==e.subsystem){var t={username:e.username,subsystem:e.subsystem};n.update(t,function(e){r.success('User: "'+e+'" successfully reinstated!"')},function(e){r.error(e.data.message)})}}}])},function(e,t,a){"use strict";angular.module("argus.controllers.alerts",["ngResource"]).controller("Alerts",["Auth","$scope","growl","Alerts","$sessionStorage","TableListService",function(e,t,a,r,n,i){function s(e,a){c.sharedList=i.getListUnderTab(e,!0,u),c.usersList=i.getListUnderTab(e,!1,u),t.alertsLoaded=!0,t.getAlerts(a)}function o(){r.getMeta().$promise.then(function(e){n.alerts.cachedData=e,n.alerts.loadedEverything=!0,s(e,t.shared)})}function l(){r.getUsers().$promise.then(function(e){n.alerts.cachedData=e,n.alerts.loadedEverything=!1,s(e,!1)})}t.colName={id:"ID",name:"Name",cronEntry:"CRON Entry",createdDate:"Created",modifiedDate:"Last Modified",ownerName:"Owner",state:"State"},t.properties={title:"Alert",type:"alerts"},t.tabNames={firstTab:e.getUsername()+"'s Alerts",secondTab:"Shared Alerts"},t.alerts=[],t.alertsLoaded=!1;var c={sharedList:[],usersList:[]},u=e.getUsername();if(t.getAlerts=function(e){n.alerts.shared=e,t.alertsLoaded&&(e&&!n.alerts.loadedEverything?(t.alertsLoaded=!1,o()):t.alerts=e?c.sharedList:c.usersList)},t.refreshAlerts=function(){delete n.alerts.cachedData,delete t.alerts,t.alertsLoaded=!1,t.shared?o():l()},t.addAlert=function(){var e={name:"new-alert-"+Date.now(),expression:"-1h:scope:metric{tagKey=tagValue}:avg",cronEntry:"0 */4 * * *"};r.save(e,function(r){r.expression="",c=i.addItemToTableList(c,"alerts",r,u),t.getAlerts(t.shared),a.success('Created "'+e.name+'"')},function(t){a.error('Failed to create "'+e.name+'"')})},t.removeAlert=function(e){r.delete({alertId:e.id},function(r){c=i.deleteItemFromTableList(c,"alerts",e,u),t.getAlerts(t.shared),a.success('Deleted "'+e.name+'"')},function(t){a.error('Failed to delete "'+e.name+'"')})},t.enableAlert=function(e,i){e.enabled!==i&&r.get({alertId:e.id},function(s){s.enabled=i,r.update({alertId:e.id},s,function(r){e.enabled=i,n.cachedAlerts=t.alerts,a.success((i?'Enabled "':'Disabled "')+e.name+'"')},function(t){a.error("Failed to "+(i?'enable "':'disable "')+e.name+'"')})})},void 0===n.alerts&&(n.alerts={}),void 0!==n.alerts.cachedData&&void 0!==n.alerts.shared){var d=n.alerts.cachedData;s(d,n.alerts.shared)}else t.shared?o():l()}])},function(e,t,a){"use strict";angular.module("argus.controllers.alerts.detail",["ngResource"]).controller("AlertsDetail",["$scope","$routeParams","$location","growl","Alerts","Triggers","Notifications","History","TriggersMap","JobExecutionDetails","$sessionStorage","Auth",function(e,t,a,r,n,i,s,o,l,c,u,d){e.alertNotEditable=!0,e.isAlertDirty=function(){return!angular.equals(e.alert,e.unmodifiedAlert)},e.isTriggerDirty=function(){return!angular.equals(e.triggers,e.unmodifiedTriggers)},e.isNotificationDirty=function(){return!angular.equals(e.notifications,e.unmodifiedNotifications)},e.updateAlert=function(){if(e.isAlertDirty()){var t=e.alert;n.update({alertId:t.id},t,function(a){e.unmodifiedAlert=angular.copy(t),r.success('Updated "'+t.name+'"'),e.fetchHistory(),e.fetchJobExecutionDetails(),void 0!==u.alerts&&delete u.alerts.cachedData},function(e){r.error('Failed to update "'+t.name+'"')})}},e.updateTriggers=function(){if(e.isTriggerDirty()){for(var t=e.triggers,a=0;a<t.length;a++)e.updateTrigger(t[a]);e.fetchHistory(),e.fetchJobExecutionDetails()}},e.updateTrigger=function(t){var a=e.unmodifiedTriggers.filter(function(e){return e.id===t.id});1!==a.length||angular.equals(a[0],t)||i.update({alertId:t.alertId,triggerId:t.id},t,function(a){e.unmodifiedTriggers.filter(function(e){e.id===t.id&&(angular.copy(t,e),r.success('Updated trigger "'+t.id+'".'))})},function(e){r.error('Failed to update "'+t.name+'"')})},e.updateNotifications=function(){if(e.isNotificationDirty()){for(var t=e.notifications,a=0;a<t.length;a++)e.updateNotification(t[a]);e.fetchHistory(),e.fetchJobExecutionDetails()}},e.updateNotification=function(t){var a=e.unmodifiedNotifications.filter(function(e){return e.id===t.id});1!==a.length||angular.equals(a[0],t)||s.update({alertId:t.alertId,notificationId:t.id},t,function(a){e.unmodifiedNotifications.filter(function(e){e.id===t.id&&(angular.copy(t,e),r.success('Updated notification "'+t.id+'".'))}),e.mapTriggers(t)},function(e){r.error('Failed to update "'+t.name+'"')})},e.resetTriggers=function(){e.triggers=angular.copy(e.unmodifiedTriggers)},e.resetAlert=function(){e.alert=angular.copy(e.unmodifiedAlert)},e.resetNotifications=function(){e.notifications=angular.copy(e.unmodifiedNotifications)},e.addTrigger=function(){var t={name:"new-trigger-"+Date.now(),type:"GREATER_THAN",threshold:0,secondaryThreshold:0,inertia:0,alertId:e.alert.id};i.save({alertId:e.alert.id},t,function(a){angular.copy(a,e.triggers),e.unmodifiedTriggers=angular.copy(e.triggers),e.fetchHistory(),e.fetchJobExecutionDetails(),r.success('Created "'+t.name+'"')},function(e){r.error('Failed to create "'+t.name+'"')})},e.addNotification=function(){var t={name:"new-notification-"+Date.now(),notifierName:"com.salesforce.dva.argus.service.alert.notifier.EmailNotifier",subscriptions:[],metricsToAnnotate:[],cooldownPeriod:0,sractionable:!1,alertId:e.alert.id};s.save({alertId:e.alert.id},t,function(a){angular.copy(a,e.notifications),e.unmodifiedNotifications=angular.copy(e.notifications),e.fetchHistory(),e.fetchJobExecutionDetails(),r.success('Created "'+t.name+'"')},function(e){r.error('Failed to create "'+t.name+'"')})},e.removeTrigger=function(t){i.delete({alertId:t.alertId,triggerId:t.id},function(a){e.triggers=e.triggers.filter(function(e){return e.id!==t.id}),e.unmodifiedTriggers=angular.copy(e.triggers),e.fetchHistory(),e.fetchJobExecutionDetails(),r.success('Deleted "'+t.name+'"')},function(e){r.error('Failed to delete "'+t.name+'"')})},e.removeNotification=function(t){s.delete({alertId:t.alertId,notificationId:t.id},function(a){e.notifications=e.notifications.filter(function(e){return e.id!==t.id}),e.unmodifiedNotifications=angular.copy(e.notifications),e.fetchHistory(),e.fetchJobExecutionDetails(),r.success('Deleted "'+t.name+'"')},function(e){r.error('Failed to delete "'+t.name+'"')})},e.mapTriggers=function(t){for(var a=0;a<e.unmodifiedTriggers.length;a++){var r=e.unmodifiedTriggers[a];l.unmap({alertId:t.alertId,notificationId:t.id,triggerId:r.id})}for(var a=0;a<t.triggersIds.length;a++){var r=t.triggersIds[a];l.map({alertId:t.alertId,notificationId:t.id,triggerId:r},null)}e.fetchHistory(),e.fetchJobExecutionDetails()},e.isTabSelected=function(t){return e.selectedTab===t},e.selectTab=function(t){e.selectedTab=t},e.fetchHistory=function(){o.query({id:e.alertId},function(t){e.history=t},function(t){r.error('Failed to get history for alert "'+e.alertId+'"')})},e.fetchJobExecutionDetails=function(){c.query({id:e.alertId},function(t){e.jobExecutionDetails=t,e.jobExecutionDetailsError=""},function(t){404==t.status?e.jobExecutionDetailsError=" No alert evaluation details found.":403==t.status?e.jobExecutionDetailsError="You are not authorized to view this data.":(e.jobExecutionDetailsError=t.statusText,r.error('Failed to get the job execution details "'+e.jobId+'"'))})},e.triggerTypes=[{label:"=",value:"EQUAL"},{label:"!=",value:"NOT_EQUAL"},{label:">",value:"GREATER_THAN"},{label:"<",value:"LESS_THAN"},{label:">=",value:"GREATER_THAN_OR_EQ"},{label:"<=",value:"LESS_THAN_OR_EQ"},{label:"<>",value:"BETWEEN"},{label:"><",value:"NOT_BETWEEN"}],e.notificationTypes=[{label:"Audit",value:"com.salesforce.dva.argus.service.alert.notifier.AuditNotifier"},{label:"Mail",value:"com.salesforce.dva.argus.service.alert.notifier.EmailNotifier"},{label:"GOC++",value:"com.salesforce.dva.argus.service.alert.notifier.GOCNotifier"},{label:"Gus",value:"com.salesforce.dva.argus.service.alert.notifier.GusNotifier"}],e.getTriggerIds=function(){for(var t=[],a=e.unmodifiedTriggers,r=0;r<a.length;r++)t.push(a[r].id);return t},e.alertId=t.alertId,e.triggers=[],e.notifications=[],e.unmodifiedTriggers=[],e.unmodifiedNotifications=[],e.alertId>0?(n.get({alertId:e.alertId},function(t){e.alert=t,e.alertNotEditable=d.isDisabled(t),e.unmodifiedAlert=angular.copy(t)},function(t){r.error('Failed to get alert "'+e.alertId+'"'),a.path("/alerts")}),i.query({alertId:e.alertId},function(t){e.triggers=t,e.unmodifiedTriggers=angular.copy(t)},function(t){r.error('Failed to get triggers for alert "'+e.alertId+'"')}),s.query({alertId:e.alertId},function(t){e.notifications=t,e.unmodifiedNotifications=angular.copy(t)},function(t){r.error('Failed to get notifications for alert "'+e.alertId+'"')}),e.fetchHistory(),e.fetchJobExecutionDetails()):(r.error('Failed to get alert "'+t.alertId+'"'),a.path("alerts")),e.selectedTab=1,e.resetAlert(),e.resetTriggers(),e.resetNotifications()}])},function(e,t){angular.module("argus.controllers.batches",["ngResource"]).controller("BatchExpressions",["$scope","AsyncMetrics","Batches","growl","BATCH_CHART_OPTIONS",function(e,t,a,r,n){function i(){e.currBatchState="Batch has expired";for(var t=0;t<e.batches.length;t++)if(e.batches[t].id==e.currBatchId){e.batches.splice(t,1);break}}function s(t){if(t.queries)for(var a in t.queries){var r=t.queries[a];if(r.result&&r.result.datapoints&&Object.keys(r.result.datapoints).length>10){var n=Object.keys(r.result.datapoints).slice(0,10),i=Object.keys(r.result.datapoints).length-10,s={};for(var o in n){var l=n[o];s[l]=r.result.datapoints[l]}r.result.datapoints=s,r.result.datapoints.and=i+" more datapoints"}}e.currBatchState=angular.toJson(t,2)}function o(e){if($("#graphs-container").empty(),e.queries)for(var t in e.queries){var a=e.queries[t].result;if(a){var r=[];for(var i in a.datapoints){var s=parseInt(i);if(a.datapoints[i]){var o=parseFloat(a.datapoints[i]);r.push([s,o])}}var c=l(a),u=angular.copy(n);u.series=[{name:c,id:c,data:r,marker:{enabled:!0,radius:1}}],u.title={text:e.queries[t].expression};var d=document.createElement("div");$("#graphs-container").append(d),$(d).highcharts("StockChart",u).css({"min-width":"310px",height:"400px",margin:"24px auto"})}}}function l(e){var t=e.scope,a=e.metric,r=c(e.tags);return t+":"+a+r}function c(e){var t="";if(e){var a="";for(var r in e)e.hasOwnProperty(r)&&(a+=r+"="+e[r]+",");a.length&&(t+="{",t+=a.substring(0,a.length-1),t+="}")}return t}$('[data-toggle="tooltip"]').tooltip(),e.hudModes=["graphs","JSON"],e.hudMode=0,e.batches=[],e.expressions=[{expression:""}],e.currTtl="",e.currBatchState="Refresh for current batch status",e.currBatchId="";var u=["queued","processing","done","error"];e.toggleHudMode=function(){0===e.hudMode?e.hudMode=1:e.hudMode=0,e.refreshBatchState()},e.getBatches=function(){e.batches=[{id:"Loading...",status:"Loading..."}],a.query().$promise.then(function(t){e.batches=[];for(var a in t)36==a.length&&e.batches.push({id:a,status:u[t[a]]})},function(){e.batches=[]})},e.getBatches(),e.addExpression=function(){e.expressions.push({expression:""})},e.removeExpression=function(){var t=e.expressions.length-1;t>=0&&e.expressions.splice(e.expressions.length-1)},e.submitBatch=function(){var a={};a.expression=[];for(var n=0;n<e.expressions.length;n++)e.expressions[n].expression.length>0&&a.expression.push(e.expressions[n].expression);a.ttl=e.currTtl,t.create(a).then(function(t){r.success("Submitted "+t.data.id),e.expressions=[{expression:""}],e.submitted=!0,e.currBatchId=t.data.id,e.getBatches(),e.refreshBatchState(e.currBatchId)},function(e){r.error(e.data.message)})},e.refreshBatchState=function(t){return t&&(e.currBatchId=t),""===e.currBatchId?void(e.currBatchState="No batch selected"):(e.currBatchState="Loading...",void(0===e.hudMode?a.query({batchId:e.currBatchId},s,i):a.query({batchId:e.currBatchId},o,i)))},e.deleteBatch=function(t){a.delete({batchId:t},function(){e.batches=e.batches.filter(function(e){return e.id!==t}),r.success("Deleted "+t)},function(){r.error("Failed to delete "+t)})}}])},function(e,t,a){"use strict";angular.module("argus.controllers.dashboards",["ngResource","ui.codemirror"]).controller("Dashboards",["Auth","$scope","growl","Dashboards","$sessionStorage","TableListService",function(e,t,a,r,n,i){function s(e,a){c.sharedList=i.getListUnderTab(e,!0,u),c.usersList=i.getListUnderTab(e,!1,u),t.dashboardsLoaded=!0,t.getDashboards(a)}function o(){r.getMeta().$promise.then(function(e){s(e,t.shared),n.dashboards.cachedData=e})}function l(){var e="<!-- This is the root level tag. All dashboards must be encapsulated within this tag. -->\n<ag-dashboard>\n\n";return e+="<!-- <ag-text> are filters used to refine a query. The values of these will be used by the <ag-metric> tag. You may define as many <ag-text> tags as the number of components you want to substitute in the argus query expression. A default value may be specified on each <ag-text> tag. The page will be loaded using these default values. -->\n",e+="<ag-date type='datetime' name='start' label='Start Date' default='-2d'></ag-date>\n",e+="<ag-date type='datetime' name='end' label='End Date' default='-0d'></ag-date>\n",e+="<ag-text type='text' name='scope' label='Scope' default='argus.jvm'></ag-text>\n",e+="<ag-text type='text' name='metric' label='Metric' default='mem.heap.used'></ag-text>\n",e+="<ag-text type='text' name='tags' label='Tags' default='host=*'></ag-text>\n",e+="<ag-text type='text' name='aggregator' label='Aggregator' default='avg'></ag-text>\n",e+="<!-- A button used to submit the query. -->\n",e+="<ag-submit>Submit</ag-submit>\n\n",e+="<!-- A dashboard template can also have arbitrary number of html tags. -->\n",e+="<h4>Argus mem heap used - Chart</h4>\n\n",e+="<!-- This defines a chart on the dashboard. A dashboard can also have tables which are defined using <ag-table> tag. This/these tags encapsulate all the options for the corresponsing tag as well as the actual metric/annotation data. -->\n",e+="<ag-chart name='Chart'>\n\n",e+="<!-- This defines options for a chart or a table. The value of 'name' attribute is directly used as the key for the config object(options object for highcharts/highstocks, config object for at-table. Hence use valid values for name attribute.). The values for the corresponding keys can either be provided using the value attribute on the tag or using innerHtml for the tag. -->\n",e+="<ag-option name='title.text' value='This title was set with a chart option'></ag-option>\n",e+="<!-- This defines each timeseries to be displayed on a chart/table. The timeseries to be displayed is specified as the innerHtml using the Argus Query Language. The individual component/s can be parameterized by placing them between $ signs and using the value of ag-text tag's name attribute. In the example below, all components have are parameterized. -->\n",e+="<ag-metric>$start$:$end$:$scope$:$metric${$tags$}:$aggregator$</ag-metric>\n",e+="</ag-chart>\n\n",e+="</ag-dashboard>"}t.colName={id:"ID",name:"Name",description:"Description",createdDate:"Created",modifiedDate:"Last Modified",ownerName:"Owner"},t.properties={title:"Dashboard",type:"dashboards"},t.tabNames={firstTab:e.getUsername()+"'s Dashboards",secondTab:"Shared Dashboards"},t.dashboards=[],t.dashboardsLoaded=!1;var c={sharedList:[],usersList:[]},u=e.getUsername();if(t.getDashboards=function(e){t.dashboardsLoaded&&(t.dashboards=e?c.sharedList:c.usersList),n.dashboards.shared=e},t.refreshDashboards=function(){delete n.dashboards.cachedData,delete t.dashboards,t.dashboardsLoaded=!1,o()},t.addDashboard=function(){var e={name:"new-dashboard-"+Date.now(),description:"A new dashboard",shared:t.shared,content:l()};r.save(e,function(r){r.content="",c=i.addItemToTableList(c,"dashboards",r,u),t.getDashboards(t.shared),a.success('Created "'+e.name+'"')},function(t){a.error('Failed to create "'+e.name+'"')})},t.deleteDashboard=function(e){r.delete({dashboardId:e.id},function(r){c=i.deleteItemFromTableList(c,"dashboards",e,u),t.getDashboards(t.shared),a.success('Deleted "'+e.name+'"')},function(t){a.error('Failed to delete "'+e.name+'"')})},void 0===n.dashboards&&(n.dashboards={}),void 0!==n.dashboards.cachedData&&void 0!==n.dashboards.shared){var d=n.dashboards.cachedData;s(d,n.dashboards.shared)}else o()}])},function(e,t,a){"use strict";angular.module("argus.controllers.dashboards.detail",["ngResource","ui.codemirror"]).controller("DashboardsDetail",["Storage","$scope","$http","$routeParams","$location","growl","Dashboards","History","$sessionStorage","Auth",function(e,t,a,r,n,i,s,o,l,c){t.dashboardNotEditable=!0,t.isDashboardDirty=function(){return!angular.equals(t.dashboard,t.unmodifiedDashboard)},t.updateDashboard=function(){if(t.isDashboardDirty()){var e=t.dashboard;s.update({dashboardId:e.id},e,function(a){t.unmodifiedDashboard=angular.copy(e),i.success('Updated "'+e.name+'"'),t.fetchHistory(),void 0!==l.dashboards&&delete l.dashboards.cachedData},function(t){i.error('Failed to update "'+e.name+'"')})}},t.resetDashboard=function(){t.dashboard=angular.copy(t.unmodifiedDashboard)},t.editorLoaded=function(e){e.setSize(null,"30em")},t.isTabSelected=function(e){return t.selectedTab===e},t.selectTab=function(e){t.selectedTab=e},t.fetchHistory=function(){o.query({id:t.dashboardId},function(e){t.jobHistoryError="",t.history=e},function(e){404==e.status?t.jobHistoryError="No job history details found.":403==e.status?(t.jobHistoryError=e.statusText,t.jobHistoryError="You are not authorized to view this data."):(t.jobHistoryError=e.statusText,i.error('Failed to get history for job "'+t.jobId+'"'))})},t.dashboardId=r.dashboardId,t.selectedTab=1,t.editorOptions={lineWrapping:!0,lineNumbers:!0,mode:"htmlmixed",viewportMargin:500},t.dashboardId>0?(s.get({dashboardId:t.dashboardId},function(e){t.dashboard=e,t.dashboardNotEditable=c.isDisabled(e),t.unmodifiedDashboard=angular.copy(e)},function(e){i.error('Failed to get dashboard "'+t.dashboardId+'"'),n.path("/dashboards")}),t.fetchHistory()):(i.error('Failed to get dashboard "'+r.dashboardId+'"'),n.path("dashboards")),t.resetDashboard()}])},function(e,t,a){"use strict";angular.module("argus.controllers.login",[]).controller("Login",["$scope",function(e){e.username=null,e.password=null}])},function(e,t){angular.module("argus.controllers.main",[]).controller("Main",["$scope","$location","Auth","$sessionStorage",function(e,t,a,r){e.login=function(e,t){e.indexOf("@")!=-1&&(e=e.substring(0,e.indexOf("@"))),a.login(e,t)},e.currentUser=function(){return a.getUsername()},e.isLoggedIn=function(){return a.isLoggedIn()},e.isPrivileged=function(){return a.isPrivileged()},r.$reset()}])},function(e,t){angular.module("argus.controllers.metricelements",[]).controller("metricElements",function(e){e.metricOptions={},this.updateOption=function(t,a){e.metricOptions[t]=a}})},function(e,t,a){"use strict";angular.module("argus.controllers.namespace",["ngResource"]).controller("Namespace",["Storage","$scope","growl","Namespace",function(e,t,a,r){t.searchText=null==e.get("namespace-searchText")?"":e.get("namespace-searchText"),t.addnamespaceflag=!1,t.namespaces=r.query(),t.updateNamespace=function(e){var n=e.usernames.toString();e.usernames=n&&n.length>0?n.split(","):[],r.update({namespaceId:e.id},e,function(r){a.success('Updated namespace "'+e.qualifier+'"');for(var n=0;n<t.namespaces.length;n++){var i=t.namespaces[n];if(i.id==r.id){t.namespaces[n]=r;break}}},function(e){a.error(e.data.message)})},t.saveNamespace=function(){var e={},n=t.users;e.qualifier=t.qulifier,e.usernames=n&&n.length>0?n.split(","):[],r.save(e,function(r){t.namespaces.push(r),t.qulifier="",t.users="",a.success('Created namespace "'+e.qualifier+'"')},function(e){a.error(e.data.message)})},t.$watch("searchText",function(t,a){t=null==t?"":t,e.set("namespace-searchText",t)})}])},function(e,t){angular.module("argus.controllers.viewelements",[]).controller("ViewElements",function(e){e.metrics={},e.annotations={},e.options={},this.updateMetric=function(t,a,r,n){var i={name:n.name,color:n.color,expression:a,metricSpecificOptions:r};e.metrics[t]=i},this.updateAnnotation=function(t,a){e.annotations[t]=a},this.updateOption=function(t,a){e.options[t]=a}})},function(e,t,a){"use strict";angular.module("argus.controllers.viewMetrics",["ngResource"]).controller("ViewMetrics",["$location","$routeParams","$scope","growl","Metrics","Annotations","SearchService","Controls","ChartDataProcessingService","DateHandlerService","$compile",function(e,t,a,r,n,i,s,o,l,c,u){function d(e){var t=a.scope,r=a.metric,n=a.tagk,i=a.tagv,s=a.namespace,o="",l=t&&t.length>1?t+":":"",c=r&&r.length>1?r:"",u="";if(n&&i)u="{"+n+"="+i+"}",a.enterTagsErr=!1;else if(n&&!i||!n&&i)return a.enterTagsErr=!0,null;var d="",g=s&&s.length>1?":"+s:"";return e&&(o="-1h:",d=":avg"),o+l+c+u+d+g}$('[data-toggle="tooltip"]').tooltip(),a.expression=t.expression?t.expression:null,a.checkMetricExpression=function(){a.expression?(a.showMetricDiscovery=!1,a.showChart=!0):(a.showMetricDiscovery=!0,a.showChart=!1)},a.checkMetricExpression(),a.$watch("expression",function(t){var a=t?o.getUrl([{name:"expression",value:t}]):"";e.search(a)}),a.getMetricData=function(){var e=[],t=[];null!==a.expression&&a.expression.length?($("#container").empty(),a.checkMetricExpression(),a.chartLoaded=!1,n.query({expression:a.expression},function(r){if(r&&r.length>0){e=l.copySeriesDataNSetOptions(r,{});for(var n=0;n<r.length;n++)t.push(l.getAlertFlagExpression(r[n]))}else e=[{noData:!0,errorMessage:"Empty result returned for the metric expression",name:JSON.stringify(a.expression).slice(1,-1),color:"Maroon"}];a.updateChart(e,t,[a.expression]),a.chartLoaded=!0},function(n){null===n.data.message?n.data.message="Something was wrong. No info.":r.error(n.data.message,{referenceId:"viewmetrics-error"}),e=[{invalidMetric:!0,errorMessage:n.statusText+"("+n.status+") - "+n.data.message.substring(0,31),name:n.config.params.expression,color:"Black"}],a.updateChart(e,t,[]),a.chartLoaded=!0})):(a.checkMetricExpression(),a.updateChart(e,t,[]),a.chartLoaded=!0)},a.searchMetrics=function(e,t){var r={namespace:"*",scope:"*",metric:"*",tagk:"*",tagv:"*",limit:25,page:1,type:"scope"},n=JSON.parse(JSON.stringify(r));return n.scope=a.scope?a.scope:"*",n.metric=a.metric?a.metric:"*",n.namespace=a.namespace?a.namespace:"*",n.tagk=a.tagk?a.tagk:"*",n.tagv=a.tagv?a.tagv:"*",n.type=t?t:"scope",t?"scope"===t?n.scope=n.scope+"*":"metric"===t?n.metric=n.metric+"*":"tagk"===t?(n.limit=10,n.tagk=n.tagk+"*"):"tagv"===t?n.tagv=n.tagv+"*":"namespace"===t&&(n.namespace=n.namespace+"*"):n.scope=n.scope+"*",s.search(n).then(function(e){return e.data})},a.isSearchMetricDisabled=function(){var e=a.scope,t=a.metric;return(void 0===e||e.length<1)&&(void 0===t||t.length<1)},a.addSearchExpression=function(){a.expression=d(!1)},a.graphSearchExpression=function(){a.expression=d(!0),a.getMetricData()},a.setPristine=function(){a.scope="",a.metric="",a.metric="",a.tagk="",a.tagv="",a.namespace="",a.search_metrics.$setPristine()},a.updateChart=function(e,t,r){if(e&&e.length>0){var n=a.$new(!1);n.chartConfig={chartId:"container",expressions:r},n.dateConfig={},n.series=e;for(var s=0;s<e.length;s++)n.series[s].graphClassName=n.chartConfig.chartId+"_graph"+(s+1);if(n.series.sort(function(e,t){var a=e.name.toUpperCase(),r=t.name.toUpperCase();return a<r?-1:a>r?1:0}),e[0].data&&e[0].data.length>0&&(n.dateConfig.startTime=c.getStartTimestamp(e),n.dateConfig.endTime=c.getEndTimestamp(e)),n.dateConfig.gmt=!0,t.length>0){var o={};o.tot=t.length;for(var s=0;s<t.length;s++)i.query({expression:t[s]}).$promise.then(function(e){if(void 0!==e&&0!==e.length){var t=l.copyFlagSeries(e);if(null===t||void 0===t)return;t.linkedTo=l.createSeriesName(e[0]),n.series=n.series.map(function(e){return e.name===t.linkedTo&&(e.flagSeries=t),e})}o.tot--,0==o.tot&&angular.element("#container").append(u('<line-chart chartConfig="chartConfig" series="series" dateconfig="dateConfig"></line-chart>')(n))},function(e){console.log("no annotation found;",e.statusText),o.tot--,0==o.tot&&angular.element("#container").append(u('<line-chart chartConfig="chartConfig" series="series" dateconfig="dateConfig"></line-chart>')(n))})}else angular.element("#container").append(u('<line-chart chartConfig="chartConfig" series="series" dateconfig="dateConfig"></line-chart>')(n))}a.series=e},a.getMetricData(null)}])},function(e,t){angular.module("argus.directives").directive("autoFocus",["$timeout","$exceptionHandler",function(e,t){return{restrict:"A",link:function(t,a){e(function(){a[0].focus()})}}}])},function(e,t){angular.module("argus.directives.confirm",[]).directive("ngConfirm",[function(){return{restrict:"A",link:function(e,t,a){t.bind("click",function(){var t=a.ngConfirm;t&&confirm(t)&&e.$apply(a.ngConfirmAction)})}}}])},function(e,t,a){"use strict";angular.module("argus.directives").directive("ngEnter",function(){return function(e,t,a){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(a.ngEnter)}),t.preventDefault())})}})},function(e,t,a){"use strict";angular.module("argus.directives").directive("ngLoading",function(e){var t='<div class="loadingSpinner"></div>';return{restrict:"A",link:function(a,r,n){var i=r.html();r.html(t),a.$watch(n.ngLoading,function(n){n?(r.html(i),e(r.contents())(a)):r.html(t)})}}})},function(e,t){angular.module("argus.directives").directive("stopEvent",function(){return{restrict:"A",link:function(e,t,a){t.bind("click",function(e){e.stopPropagation()})}}})},function(e,t,a){"use strict";angular.module("argus.directives.breadcrumbs",[]).directive("breadcrumbsHtml",function(){return{restrict:"E",templateUrl:"js/templates/breadcrumbs.html",scope:{},controller:["$scope","breadcrumbs",function(e,t){e.breadcrumbs=t}],link:function(e,t,a){}}})},function(e,t,a){"use strict";angular.module("argus.directives.charts.chart",[]).directive("agChart",["Metrics","Annotations","ChartRenderingService","ChartDataProcessingService","ChartOptionService","DateHandlerService","CONFIG","VIEWELEMENT","$compile",function(e,t,a,r,n,i,s,o,l){function c(e,t,a,r,n){$("#"+t).empty();var s=e.$new(!1);s.chartConfig=n,s.chartConfig.chartId=t,s.chartConfig.smallChart=e.chartOptions?e.chartOptions.smallChart:void 0,s.series=a,void 0!=r.startTime&&void 0!=r.endTime||a[0].data&&a[0].data.length>0&&(r.startTime=i.getStartTimestamp(a),r.endTime=i.getEndTimestamp(a)),s.dateConfig=r;for(var o=0;o<a.length;o++)s.series[o].graphClassName=t+"_graph"+(o+1);s.series=s.series.sort(function(e,t){var a=e.name.toUpperCase(),r=t.name.toUpperCase();return a<r?-1:a>r?1:0}),e.seriesDataLoaded=!0,angular.element("#"+t).append(l('<line-chart chartConfig="chartConfig" series="series" dateconfig="dateConfig"></line-chart>')(s))}function u(e,a,n,i,s,o){t.query({expression:a}).$promise.then(function(t){if(t&&t.length>0){var a=r.createSeriesName(t[0]),l=r.copyFlagSeries(t);l.linkedTo=a,i[0].flagSeries=l?l:null}c(e,n,i,s,o)},function(t){console.log("no data found",t.data.message),c(e,n,i,s,o)})}function d(e,t,a,r,n,i){if(0===r.length)c(e,t,a,n,i);else for(var s=0;s<r.length;s++){var o=r[s];u(e,o,t,a,n,i)}}function g(t,n,i,s,o,l,c,u,g){if(n){var h=!!u.smallchart;e.query({expression:n.expression}).$promise.then(function(e){var f;if(e&&e.length>0){if(h){var p=r.getLastDataPoint(e[0].datapoints);a.updateIndicatorStatus(u,p),t.chartOptions={smallChart:h}}f=r.copySeriesDataNSetOptions(e,n),i.expressions.push(n.expression)}else console.log("Empty result returned for the metric expression"),f=[{noData:!0,errorMessage:"Empty result returned for the metric expression",name:JSON.stringify(n.expression).slice(1,-1),color:"Maroon"}];Array.prototype.push.apply(o,f),i.tot-=1,0===i.tot&&(g.expressions=i.expressions,d(t,s,o,l,c,g))},function(e){console.log("Metric expression does not exist in database");var a=[{invalidMetric:!0,errorMessage:e.statusText+"("+e.status+") - "+e.data.message.substring(0,31),name:e.config.params.expression,color:"Black"}];Array.prototype.push.apply(o,a),i.tot-=1,0===i.tot&&d(t,s,o,l,c,g)})}}function h(e,t,n,s){t.empty();var c="element_"+o.chart+f++,u=(n.type?n.type:"LINE",n.smallchart?"smallChart":"");a.setChartContainer(t,c,u);for(var d={metrics:e.metrics,annotations:e.annotations,options:e.options},h={},p=!1,m=0;m<s.length;m++)if("agDate"===s[m].type){var v=s[m].value;"start"===s[m].name?(h.startTime=i.timeProcessingHelper(v),p=p||i.GMTVerifier(v)):"end"===s[m].name&&(h.endTime=i.timeProcessingHelper(v),p=p||i.GMTVerifier(v))}h.gmt=p;var b=r.processMetricData(d,s);
if(!b)return void console.log("no processed data returned: "+c);var y=b.updatedMetricList,x=b.updatedAnnotationList,T=b.updatedOptionList,w=[],C={};C.tot=y.length,C.expressions=[],e.seriesDataLoaded=!1,angular.element("#"+c).append(l('<div ng-loading="seriesDataLoaded"></div>')(e));for(var m=0;m<y.length;m++){var D=y[m];g(e,D,C,c,w,x,h,n,T)}}var f=1;return{restrict:"E",transclude:!0,scope:{},require:"^agDashboard",controller:"ViewElements",template:'<div ng-transclude=""></div>',compile:function(e,t,a){return{post:function(e,t,a,r,n){e.$on(r.getSubmitBtnEventName(),function(r,n){h(e,t,a,n)})}}}}}])},function(e,t){angular.module("argus.directives.charts.flags",[]).directive("agFlags",function(){var e=100;return{restrict:"E",require:"^agChart",scope:{expression:"@"},template:"",link:function(t,a,r,n){var i="flag_"+e++;a.text()&&a.text().length>0&&n.updateAnnotation(i,a.text().replace(/(\r\n|\n|\r|\s+)/gm,"")),t.$watch("expression",function(e,t){e&&n.updateAnnotation(i,e)}),a.html("<span> </span>")}}})},function(e,t){angular.module("argus.directives.charts.heatmap",[]).directive("agHeatmap",["DashboardService","growl","VIEWELEMENT",function(e,t,a){var r=1;return{restrict:"E",transclude:!0,scope:{},require:"^agDashboard",controller:"ViewElements",template:'<div ng-transclude=""> </div>',link:function(t,n,i,s){e.buildViewElement(t,n,i,s,a.heatmap,r++,e)}}}])},function(e,t,a){"use strict";angular.module("argus.directives.charts.lineChart",[]).directive("lineChart",["$timeout","Storage","$routeParams",function(e,t,a){function r(){e.cancel(n),n=e(function(){s.forEach(function(e){e()})},i)}var n,i=250,s=[],o=0,l="linechart_";return d3.select(window).on("resize",r),{restrict:"E",replace:!0,scope:{chartConfig:"=chartconfig",series:"=series",dateConfig:"=dateconfig"},templateUrl:"js/templates/charts/topToolbar.html",controller:["$scope","Metrics","DownloadHelper","growl",function(e,t,a,r){function n(t){var a=t.displaying?"none":null;t.displaying=!t.displaying,d3.selectAll("."+t.graphClassName).style("display",a),e.reScaleY(),e.redraw()}e.downloadData=function(n){e.chartConfig.expressions.map(function(e){var i,s;switch(n){case"query":i=function(e){return JSON.stringify(e.slice(0,e.length))},s="data.json";break;case"downloadCSV":i=function(e){return e[0]},s="data.csv"}r.info("Downloading data..."),t[n]({expression:e}).$promise.then(function(e){a.downloadFile(i(e),s)},function(e){r.error("Data cannot be download this time"),console.log(e)})})},e.sources=[],e.otherSourcesHidden=!1,e.noDataSeries=[],e.invalidSeries=[],e.toggleSource=function(e){n(e)},e.hideOtherSources=function(t){for(var a=e.sources,r=0;r<a.length;r++)t.name!==a[r].name&&n(a[r]);e.otherSourcesHidden=!e.otherSourcesHidden},e.labelTextColor=function(e){return e.displaying?e.color:"#FFF"}}],link:function(e,r,n){function i(){_?(te=d3.scaleUtc().domain([j,q]).range([0,Je]),ae=d3.scaleUtc().domain([j,q]).range([0,Je])):(te=d3.scaleTime().domain([j,q]).range([0,Je]),ae=d3.scaleTime().domain([j,q]).range([0,Je])),re=d3.scaleLinear().range([Xe,0]),ne=d3.scaleLinear().range([Ke,0]),ie=d3.axisBottom().scale(te).ticks(ht),se=d3.axisBottom().scale(ae).ticks(ht),oe=d3.axisLeft().scale(re).ticks(ft).tickFormat(d3.format(".2s")),le=d3.axisRight().scale(re).ticks(ft).tickFormat(d3.format(".2s")),ce=d3.axisBottom().scale(te).ticks(ht).tickSizeInner(-Xe),ue=d3.axisLeft().scale(re).ticks(ft).tickSizeInner(-Je),de=d3.line().x(function(e){return te(e[0])}).y(function(e){return re(e[1])}),ge=d3.line().x(function(e){return ae(e[0])}).y(function(e){return ne(e[1])}),he=d3.brushX().extent([[0,0],[Je,Ke]]).on("brush end",m),fe=d3.brushX().extent([[0,0],[Je,Xe]]).on("end",v),pe=d3.zoom().scaleExtent([1,1/0]).translateExtent([[0,0],[Je,Xe]]).extent([[0,0],[Je,Xe]]).on("zoom",b).on("start",function(){be.select(".chartOverlay").style("cursor","move")}).on("end",function(){be.select(".chartOverlay").style("cursor","crosshair")}),me=d3.select(X).append("svg").attr("width",Je+Qe.left+Qe.right).attr("height",Xe+Qe.top+Qe.bottom),ve=me.append("g").attr("transform","translate("+Qe.left+","+Qe.top+")"),be=ve.append("g"),ye=be.append("g").attr("class","x axis").attr("transform","translate(0,"+Xe+")").call(ie),Te=be.append("g").attr("class","y axis").call(oe),void 0!==z.xAxis&&void 0!==z.xAxis.title&&be.append("text").attr("class","xAxisLabel").attr("transform","translate("+Je/2+" ,"+(Xe+Qe.top+Be)+")").style("text-anchor","middle").style("font-size",12).text(z.xAxis.title.text),void 0!==z.yAxis&&void 0!==z.yAxis.title&&be.append("text").attr("class","yAxisLabel").attr("transform","rotate(-90)").attr("y",0-Qe.left).attr("x",0-Xe/2).attr("dy","1em").style("text-anchor","middle").style("font-size",12).text(z.yAxis.title.text),we=be.append("g").attr("class","y axis").attr("transform","translate("+Je+")").call(le),Ce=be.append("g").attr("class","x grid").attr("transform","translate(0,"+Xe+")").call(ce),De=be.append("g").attr("class","y grid").call(ue),Se=ve.append("defs").append("clipPath").attr("name","clip").attr("id","clip_"+B).append("rect").attr("width",Je).attr("height",Xe),Ee=ve.append("g").attr("class","context").attr("transform","translate(0,"+Ze.top+")"),Ae=ve.append("g").attr("class","flags"),xe=Ee.append("g").attr("class","xBrush axis").attr("transform","translate(0,"+Ke+")").call(se),$e=be.append("g").attr("class","focus").style("display","none"),Oe=ve.append("g").attr("class","tooltip").style("opacity",1).style("display","none"),Le=Oe.append("rect").attr("rx",et).attr("ry",et),ke=Oe.append("g").attr("class","tooltip-items"),Pe=$e.append("g").attr("name","crossLine"),Pe.append("line").attr("name","crossLineX").attr("class","crossLine"),Pe.append("line").attr("name","crossLineY").attr("class","crossLine"),Pe.append("rect").attr("name","crossLineTipRectX").attr("class","crossLineTipRect"),Pe.append("rect").attr("name","crossLineTipRectY").attr("class","crossLineTipRect"),Pe.append("text").attr("name","crossLineTipY").attr("class","crossLineTip"),Pe.append("text").attr("name","crossLineTipX").attr("class","crossLineTip"),Re=d3.select("#"+B).select("svg").select(".flags"),Ve=d3.tip().attr("class","d3-tip").offset([-10,0]),d3.select("#"+B).select("svg").call(Ve)}function c(e){vt.domain(Ue),e.forEach(function(e){if(0!==e.data.length){var t=null===e.color?vt(e.name):e.color;if(be.append("path").attr("class","line "+e.graphClassName).style("stroke",t).style("clip-path","url('#clip_"+B+"')"),Ee.append("path").attr("class","brushLine "+e.graphClassName+"_brushline").style("stroke",t),$e.append("circle").attr("r",at).attr("fill",t).attr("class",e.graphClassName),ke.append("circle").attr("r",at).attr("fill",t).attr("class",e.graphClassName),ke.append("text").attr("class",e.graphClassName),e.flagSeries){var a=e.flagSeries.data;a.forEach(function(a){var r=Re.append("g").attr("class","flagItem "+e.graphClassName).attr("id",e.graphClassName+a.flagID).style("stroke",t).on("mouseover",function(){var e=_?gt(a.x):dt(a.x);e="<strong>"+e+"</strong><br/>"+a.text,Ve.style("border-color",t).html(e),Ve.show(),parseInt(Ve.style("left"))<15&&Ve.style("left","15px")}).on("mouseout",Ve.hide);r.append("line").attr("y2",35).attr("stroke-width",2),r.append("circle").attr("r",8).attr("class","flag"),r.append("text").attr("dy",4).style("text-anchor","middle").style("stroke","black").text(a.title)})}}})}function u(){if(Q&&0!==Q.length){var t=[],a=d3.mouse(this),r=a[0],n=a[1],i=te.invert(r),s=re.invert(n);k()&&(Q.forEach(function(a){if(0!==a.data.length){var r,n=a.data,s=ut(n,i,1),o=n[s-1],l=n[s];r=o?l&&i-o[0]>l[0]-i?l:o:l;var c=$e.select("."+a.graphClassName);r[0]<te.domain()[0]||r[0]>te.domain()[1].getTime()||r[1]<re.domain()[0]||r[1]>re.domain()[1]?c.attr("display","none"):c.attr("display",null),c.attr("dataX",r[0]).attr("dataY",r[1]).attr("transform","translate("+te(r[0])+","+re(r[1])+")");var u=e.sources.find(function(e){return e.graphClassName===a.graphClassName});u.displaying&&t.push({data:r,graphClassName:a.graphClassName,name:a.name})}}),e.menuOption.isTooltipSortOn&&(t=t.sort(function(e,t){return t.data[1]-e.data[1]})),d(ke,t,r,n)),h(i,s,r,n)}}function d(t,a,r,n){var i=0,s=0,o=0,l=-1,c=8,u=2*at;e.menuOption.isTooltipDetailOn?c=14:a.length<2*c&&(c=Math.ceil(a.length/2));for(var d=0;d<a.length;d++){d%c===0&&(l++,s=l*c,i+=o,o=0);var g=a[d].data[1],h=(t.select("circle."+a[d].graphClassName).attr("cy",20*(.75+d-s)+n).attr("cx",r+tt+et+at+i),t.select("text."+a[d].graphClassName).attr("dy",20*(1+d-s)+n).attr("dx",r+tt+et+u+2+i));e.menuOption.isTooltipDetailOn?h.text(a[d].name+"   "+d3.format("0,.7")(g)):h.text(d3.format(".2s")(g));var f=h.node().getBBox().width+u+tt;f>o&&(o=f)}var p=t.node().getBBox();Le.attr("x",r+tt),Le.attr("y",n+tt),0===p.width||0===p.height?(Le.attr("width",0),Le.attr("height",0)):(Le.attr("width",p.width+4*et),Le.attr("height",p.height+2*et));var m;m=r+Number(Le.attr("width"))>Je+Ye&&r-Number(Le.attr("width"))>0?"translate(-"+(Number(Le.attr("width"))+2*tt)+")":null,t.attr("transform",m),Le.attr("transform",m)}function g(t,a,r){for(var n=[],i=0;i<t.length;i++){var s=null===a[i]?vt(t[i]):a[i];n.push({name:t[i],displaying:!0,color:s,graphClassName:r[i]})}e.sources=n}function h(e,t,a,r){$e.select("[name=crossLineX]").attr("x1",a).attr("y1",0).attr("x2",a).attr("y2",Xe),$e.select("[name=crossLineY]").attr("x1",0).attr("y1",r).attr("x2",Je).attr("y2",r);var n;n=isNaN(t)?"No Data":d3.format(".2s")(t),$e.select("[name=crossLineTipY").attr("x",0).attr("y",r).attr("dx",-rt).text(n);var i=$e.select("[name=crossLineTipY]").node().getBBox();$e.select("[name=crossLineTipRectY]").attr("x",i.x-it).attr("y",i.y-it).attr("width",i.width+2*it).attr("height",i.height+2*it);var s=_?gt(e):dt(e);$e.select("[name=crossLineTipX]").attr("x",a).attr("y",0).attr("dy",nt).text(s);var o=$e.select("[name=crossLineTipX]").node().getBBox();$e.select("[name=crossLineTipRectX]").attr("x",o.x-it).attr("y",o.y-it).attr("width",o.width+2*it).attr("height",o.height+2*it)}function f(){ve.selectAll(".brush").call(he.move,null),ve.selectAll(".brushMain").call(he.move,null)}function p(){var t=te.domain()[0].getTime(),a=te.domain()[1].getTime();k()?(be.selectAll("path.line").attr("display",null),Q.forEach(function(r,n){if(null!==r&&0!==r.data.length&&e.sources[n].displaying){var i=r.data.length;if(r.data[0][0]>a||r.data[i-1][0]<t)return void be.select("path.line."+r.graphClassName).datum([]).attr("d",de);var s=ut(r.data,te.domain()[0]);s>0&&(s-=1);var o=ut(r.data,te.domain()[1],s)+1,l=r.data.slice(s,o+1);be.select("path.line."+r.graphClassName).datum(l).attr("d",de)}})):be.selectAll("path.line").attr("display","none"),ye.call(ie),Te.call(oe),we.call(le),Ce.call(ce),De.call(ue),e.menuOption.isBrushOn||Ee.attr("display","none"),A(),D()}function m(){if(!d3.event.sourceEvent||"zoom"!==d3.event.sourceEvent.type){var e=d3.event.selection||ae.range();te.domain(e.map(ae.invert,ae)),x(),p(),Me.call(pe.transform,d3.zoomIdentity.scale(Je/(e[1]-e[0])).translate(-e[0],0)),Ne&&Ne.call(pe.transform,d3.zoomIdentity.scale(Je/(e[1]-e[0])).translate(-e[0],0))}}function v(){var e=d3.event.selection;if(e){var t=te.invert(e[0]),a=te.invert(e[1]),r=a-t;if(Ne.call(fe.move,null),r*K<ae.domain()[1]-ae.domain()[0])return;te.domain([t,a]),Ie.call(he.move,[ae(t),ae(a)])}}function b(){if(!d3.event.sourceEvent||"brush"!==d3.event.sourceEvent.type&&"end"!==d3.event.sourceEvent.type){var e=d3.event.transform;te.domain(e.rescaleX(ae).domain()),x(),p(),Ee.select(".brush").call(he.move,te.range().map(e.invertX,e));var t=d3.mouse(this),a=t[0],r=t[1],n=te.invert(a),i=re.invert(r);k()?$e.selectAll("circle").attr("display",null).each(function(e,t){var a=d3.select(this),r=a.attr("dataX"),n=a.attr("dataY");a.attr("transform","translate("+te(r)+","+re(n)+")"),(r<te.domain()[0]||r>te.domain()[1])&&a.attr("display","none")}):$e.selectAll("circle").attr("display","none"),h(n,i,a,r)}}function y(e){return function(){e||(e=ae.domain()[1]-ae.domain()[0]);var t=6e4*e,a=te.domain()[0].getTime(),r=te.domain()[1].getTime(),n=(a+r)/2;a=n-t/2;var i=ae.domain()[0].getTime(),s=ae.domain()[1].getTime();a<i&&(a=i),r=a+t,r>s&&(r=s),Ee.select(".brush").call(he.move,[ae(new Date(a)),ae(new Date(r))])}}function x(){if("series"!==Q&&Q&&(void 0===R||void 0===V)){var t=te.domain(),a=[];Q.forEach(function(r,n){if(null!==r&&0!==r.data.length&&e.sources[n].displaying){var i=r.data.length;if(!(r.data[0][0]>t[1].getTime()||r.data[i-1][0]<t[0].getTime())){var s=ut(r.data,t[0]),o=ut(r.data,t[1],s);a=a.concat(r.data.slice(s,o+1))}}});var r=d3.extent(a,function(e){return e[1]}),n=r[1]-r[0];0===n&&(n=pt);var i=n*st,s=void 0===R?r[0]-i:R,o=void 0===V?r[1]+3*i:V;re.domain([s,o])}}function T(){if("series"!==H&&H&&(ee=$(X).width(),Je=ee-We-Ye,!(Je<0)))if(Qe={top:_e,right:Ye,bottom:Z-_e-Xe,left:We},Ze={top:Z-Ke-ze,right:Ye,bottom:ze,left:We},H.length>0){var e=te.domain();Se.attr("width",Je).attr("height",Xe),Me.attr("width",Je),te.range([0,Je]),ae.range([0,Je]),he.extent([[0,0],[Je,Ke]]),fe.extent([[0,0],[Je,Xe]]),pe.translateExtent([[0,0],[Je,Xe]]).extent([[0,0],[Je,Xe]]),Ie.call(he),Ne.call(fe),me.attr("width",Je+Qe.left+Qe.right),ve.attr("width",Je).attr("transform","translate("+Qe.left+","+Qe.top+")"),ue.tickSizeInner(-Je),De.call(ue),we.attr("transform","translate("+Je+")").call(le),ve.selectAll(".line").attr("d",de),ve.selectAll(".brushLine").attr("d",ge),ye.call(ie),Te.call(oe),Ce.call(ce),xe.call(se),void 0!==z.xAxis&&void 0!==z.xAxis.title&&be.select(".xAxisLabel").attr("transform","translate("+Je/2+" ,"+(Xe+Qe.top+Be)+")"),e[0].getTime()==ae.domain()[0].getTime()&&e[1].getTime()==ae.domain()[1].getTime()?f():Ee.select(".brush").call(he.move,[ae(e[0]),ae(e[1])])}else C(X,Je,Xe,Qe,mt)}function w(e){var t=[];Q=e,e.forEach(function(e){t=t.concat(e.data)}),Y=d3.extent(t,function(e){return e[0]}),j||(j=Y[0]),q||(q=Y[1]),te.domain(Y);var a=d3.extent(t,function(e){return e[1]});a[0]===a[1]&&(a[0]-=pt,a[1]+=3*pt),void 0!==R&&void 0!==V?re.domain([R,V]):re.domain(a),ae.domain(te.domain()),ne.domain(a),e.forEach(function(e){0!==e.data.length&&(be.select("path.line."+e.graphClassName).datum(e.data).attr("d",de),Ee.select("path.brushLine."+e.graphClassName+"_brushline").datum(e.data).attr("d",ge))}),xe.call(se),O(3),D()}function C(e,t,a,r,n){me&&me.remove(),me=d3.select(e).append("svg").attr("width",t+r.left+r.right).attr("height",a+r.top+r.bottom),me.selectAll("text").data(n).enter().append("text").attr("x",r.left+t/2).attr("y",function(e,t){return 20*t+r.top}).style("text-anchor","middle").style("font-size","12px").text(function(e){return e})}function D(){H&&H.forEach(function(e){if(e.flagSeries){var t=e.flagSeries.data;t.forEach(function(t){var a=Re.select("#"+e.graphClassName+t.flagID),r=te(t.x),n=Xe-35;t.x<te.domain()[0]||t.x>te.domain()[1]?a.attr("display","none"):(a.attr("display",null),a.attr("transform","translate("+r+", "+n+")"))})}})}function E(){Me=be.append("rect").attr("class","chartOverlay").attr("width",Je).attr("height",Xe).on("mouseover",function(){P()}).on("mouseout",function(){$e.style("display","none"),e.menuOption.isTooltipOn&&Oe.style("display","none")}).on("mousemove",u).call(pe),Ie=Ee.append("g").attr("class","brush").call(he).call(he.move,te.range()),Ne=be.append("g").attr("class","brushMain").call(pe).on("mousedown.zoom",null).call(fe).on("mouseover",function(){P()}).on("mouseout",function(){$e.style("display","none"),e.menuOption.isTooltipOn&&Oe.style("display","none")}).on("mousemove",u),e.menuOption.isBrushMainOn?Ne.attr("display",null):Ne.attr("display","none"),e.menuOption.isWheelOn||(Me.on("wheel.zoom",null),Ne.on("wheel.zoom",null))}function S(){var t=e.menuOption.isBrushOn?null:"none";ve.select(".context").attr("display",t),G()}function I(){e.menuOption.isBrushMainOn?Ne.attr("display",null):Ne.attr("display","none"),G()}function N(){e.menuOption.isWheelOn?(Me.call(pe),Ne.call(pe).on("mousedown.zoom",null)):(Me.on("wheel.zoom",null),Ne.on("wheel.zoom",null)),G()}function M(){e.menuOption.isTooltipOn?ve.select(".tooltip").attr("display","none"):ve.select(".tooltip").attr("display",null),G()}function A(){var t,a,r;if(_)t=gt(te.domain()[0]),a=gt(te.domain()[1]),r=t+" - "+a+" (GMT/UTC)";else{t=dt(te.domain()[0]),a=dt(te.domain()[1]);var n=(new Date).toString(),i=n.substring(n.length-6,n.length);r=t+" - "+a+i}e.dateRange=r,d3.select("#topTb-"+B+" .dateRange").text(r)}function O(e){for(var t=Q[0].data.length,a=1;a<Q.length;a++)t<Q[a].data.length&&(t=Q[a].data.length);(!e||e>t)&&(e=3),pe.scaleExtent([1,t/e]),K=parseInt(t/e)}function L(){var e=ae.domain()[1]-ae.domain()[0];e>36e5&&$("[name=oneHour]",J).prop("disabled",!1),e>864e5&&$("[name=oneDay]",J).prop("disabled",!1),e>6048e5&&$("[name=oneWeek]",J).prop("disabled",!1),e>2592e6&&$("[name=oneMonth]",J).prop("disabled",!1),e>31536e6&&$("[name=oneYear]",J).prop("disabled",!1)}function k(){return te.domain()[0].getTime()<=Y[1]&&te.domain()[1].getTime()>=Y[0]}function P(){$e.style("display",null),k()?e.menuOption.isTooltipOn&&Oe.style("display",null):($e.selectAll("circle").attr("display","none"),Oe.attr("display","none"))}function U(){$("[name=reset]",J).click(f),$("[name=oneHour]",J).click(y(60)),$("[name=oneDay]",J).click(y(1440)),$("[name=oneWeek]",J).click(y(10080)),$("[name=oneMonth]",J).click(y(43200)),$("[name=oneYear]",J).click(y(525600)),$("[name=toggle-brush]",J).change(S),$("[name=toggle-brush-main]",J).change(I),$("[name=toggle-wheel]",J).change(N),$("[name=toggle-tooltip]",J).change(M)}function F(){e.hideMenu=!0}function G(){t.set("menuOption_"+e.dashboardId+"_"+l+e.lineChartId,e.menuOption)}e.lineChartId=++o;var R,V,B=e.chartConfig.chartId,H=e.series,j=e.dateConfig.startTime,q=e.dateConfig.endTime,_=e.dateConfig.gmt,z=e.chartConfig;z.yAxis&&(R=z.yAxis.min,V=z.yAxis.max),z.yaxis&&(R=R||z.yaxis.min,V=V||z.yaxis.max),isNaN(R)&&(R=void 0),isNaN(V)&&(V=void 0),e.menuOption={isWheelOn:!1,isBrushOn:!z.smallChart,isBrushMainOn:!1,isTooltipOn:!0,isTooltipSortOn:!1,isTooltipDetailOn:!1},e.hideMenu=!1,e.dashboardId=a.dashboardId;var W=t.get("menuOption_"+e.dashboardId+"_"+l+e.lineChartId);W&&(e.menuOption=W);var Y,J=$(r),X=J.parent()[0],K=100,Q=H,Z=z.smallChart?150:330,ee=$("#"+B).width();void 0!==z.chart&&(Z=void 0===z.chart.height?Z:z.chart.height,ee=void 0===z.chart.width?ee:z.chart.width);var te,ae,re,ne,ie,se,oe,le,ce,ue,de,ge,he,fe,pe,me,ve,be,ye,xe,Te,we,Ce,De,$e,Ee,Se,Ie,Ne,Me,Ae,Oe,Le,ke,Pe,Ue,Fe,Ge,Re,Ve,Be=15,He=20,je=.8,qe=.2,_e=z.smallChart?5:15,ze=35,We=50,Ye=z.smallChart?5:60,Je=ee-We-Ye,Xe=parseInt((Z-_e-ze)*je),Ke=parseInt((Z-_e-ze)*qe)-He,Qe={top:_e,right:Ye,bottom:Z-_e-Xe,left:We},Ze={top:Z-Ke-ze,right:Ye,bottom:ze,left:We},et=3,tt=8,at=4.5,rt=35,nt=15,it=3,st=.2,ot="%b %e, %H:%M",lt="%-m/%-d/%y %H:%M:%S",ct="%x",ut=d3.bisector(function(e){return e[0]}).left,dt=z.smallChart?d3.timeFormat(ct):d3.timeFormat(ot),gt=z.smallChart?d3.utcFormat(ct):d3.utcFormat(lt),ht=(d3.format(","),z.smallChart?3:7),ft=z.smallChart?3:5,pt=1,mt=["No graph available"],vt=d3.scaleOrdinal(d3.schemeCategory20);if(e.redraw=p,e.reScaleY=x,H&&0!==H.length){Ue=H.map(function(e){return e.name}),Fe=H.map(function(e){return e.color}),Ge=H.map(function(e){return e.graphClassName}),g(Ue,Fe,Ge);for(var bt,yt,xt,Tt=[],wt=0;wt<H.length;wt++)H[wt].invalidMetric?(e.invalidSeries.push(H[wt]),xt=!0):H[wt].noData?(e.noDataSeries.push(H[wt]),yt=!0):0===H[wt].data.length?bt=!0:Tt.push(H[wt]);if(H=Tt,H.length>0)i(),c(H),w(H),E(),A(),L(),f(),U();else{if(xt){mt.push("Metric does not exist in TSDB");for(var wt=0;wt<e.invalidSeries.length;wt++)mt.push(e.invalidSeries[wt].errorMessage);mt.push("(Failed metrics are black in the legend)")}yt&&(mt.push("No data returned from TSDB"),mt.push("(Empty metrics are labeled maroon)")),bt&&(mt.push("No data found for metric expressions"),mt.push("(Valid sources have normal colors)")),C(X,Je,Xe,Qe,mt),F()}}else console.log("Empty data from chart data processing"),F();r.on("$destroy",function(){o&&(s=[],o=0)}),s.push(T)}}}])},function(e,t){angular.module("argus.directives.charts.metric",[]).directive("agMetric",["UtilService",function(e){var t=100;return{restrict:"E",require:["?^agChart","?^agStatusIndicator","?^agHeatmap","?^agTable"],scope:{expression:"@"},controller:"metricElements",template:"",link:function(a,r,n,i){var s,o="",l={},c="metric_"+t++;s=e.assignController(i),l.color=n.seriescolor,l.name=n.seriesname,o=n.value&&n.value.length>0?n.value:r.text(),o&&o.length>0&&s.updateMetric(c,o.replace(/(\r\n|\n|\r|\s+)/gm,""),a.metricOptions,l),a.$watch("expression",function(e,t){e&&s.updateMetric(c,e,a.metricOptions,l)}),r.html("<span> </span>")}}}])},function(e,t){angular.module("argus.directives.charts.option",[]).directive("agOption",["UtilService",function(e){return{restrict:"E",require:["?^agChart","?^agHeatmap","?^agTable","?^agMetric"],scope:{},template:"",link:function(t,a,r,n){var i;i=e.assignController(n);var s="";s=r.value&&r.value.length>0?r.value:a.text(),i.updateOption(r.name,s),a.html("<span> </span>")}}}])},function(e,t){angular.module("argus.directives.charts.statusIndicator",[]).directive("agStatusIndicator",["ChartDataProcessingService","ChartRenderingService","DashboardService","VIEWELEMENT",function(e,t,a,r){return{restrict:"E",transclude:!0,scope:{serviceName:"@name",hi:"@hi",lo:"@lo"},require:"^agDashboard",controller:"ViewElements",template:'<div ng-transclude=""> </div>',link:function(r,n,i,s){var o,l='<div class="serviceItem"><div class="serviceName">'+i.name+'</div><div id="'+i.name+'-status" class="statusIndicator"></div></div>';n.html(l),r.$on(s.getSubmitBtnEventName(),function(n,s){for(var l in r.metrics)r.metrics.hasOwnProperty(l)&&(o=r.metrics[l].expression,s&&(o=e.augmentExpressionWithControlsData(n,o,s)));o&&a.getMetricData(o).then(function(a){var r=e.getLastDataPoint(a.data[0].datapoints);t.updateIndicatorStatus(i,r)})})}}}])},function(e,t){angular.module("argus.directives.charts.table",[]).directive("agTable",["DashboardService","growl","VIEWELEMENT",function(e,t,a){var r=1;return{restrict:"E",transclude:!0,scope:{},require:"^agDashboard",controller:"ViewElements",template:'<div ng-transclude=""></div>',link:function(n,i,s,o){e.buildViewElement(n,i,s,o,a.table,r++,e,t)}}}])},function(e,t){angular.module("argus.directives.controls.dashboard",[]).directive("agDashboard",["$location","$rootScope","$routeParams","Controls",function(e,t,a,r){return{restrict:"E",scope:{name:"@"},transclude:!0,template:'<div ng-transclude=""></div>',controller:function(t){t.controls=[],this.updateControl=function(e,r,n,i){var s=!1;if(!i)for(var o in a)o==t.controlName&&(r=a[o]);for(var l in t.controls)if(t.controls[l].name===e){t.controls[l].value=r,s=!0;break}if(!s){var c={name:e,value:r,type:n};t.controls.push(c)}this.addControlsToUrl()},this.addControlsToUrl=function(){var a=t.controls,n=r.getUrl(a);e.search(n)},this.getAllControls=function(){return t.controls},this.getSubmitBtnEventName=function(){return"submitButtonEvent"},this.broadcastEvent=function(e,a){console.log(e+" was broadcast"),t.$broadcast(e,a)}},link:function(e,t,a){a.onload&&1!=a.onload||e.$broadcast("submitButtonEvent",e.controls)}}}])},function(e,t,a){"use strict";angular.module("argus.directives.controls.date",[]).directive("agDate",["CONFIG","$routeParams",function(e,t){return{restrict:"E",scope:{controlName:"@name",labelName:"@label",controlValue:"@default"},controller:function(e,a){e.ctrlVal=e.controlValue;for(var r in t)r==e.controlName&&(e.ctrlVal=t[r],e.ctrlVal.indexOf("GMT")>=0&&(e.ctrlVal=e.ctrlVal.replace("GMT","").trim(),e.GMTon=!0));e.datetimepickerConfig={dropdownSelector:".my-toggle-select",minuteStep:1},e.onSetTime=function(t,r){e.ctrlVal=a("date")(t,"short")}},require:"^agDashboard",template:'<strong>{{labelName}} </strong><div class="dropdown" style="display: inline;"><a class="dropdown-toggle my-toggle-select" id="dLabel" role="button" data-toggle="dropdown" data-target="#" href=""><input type="text" class="input-medium" style="color:#000;" ng-model="ctrlVal"></a><ul class="dropdown-menu" role="menu" aria-labelledby="dLabel"><datetimepicker ng-model="data.date" on-set-time="onSetTime(newDate, oldDate)" data-datetimepicker-config="datetimepickerConfig"></datetimepicker></ul></div><label class="GMT-select">GMT: <input type="checkbox" ng-model="GMTon" ng-checked="GMTon || (ctrlVal[0] === \'-\')" ng-disabled="ctrlVal[0] === \'-\'"></label>',link:function(e,t,a,r){function n(t,a){a?r.updateControl(e.controlName,t+" GMT","agDate",!0):r.updateControl(e.controlName,t,"agDate",!0)}n(e.ctrlVal,e.GMTon),e.$watch("ctrlVal",function(t,a){n(t,e.GMTon)}),e.$watch("GMTon",function(t,a){n(e.ctrlVal,t)})}}}])},function(e,t){angular.module("argus.directives.controls.dropdown",[]).directive("agDropdown",["CONFIG","Tags",function(e,t){return{restrict:"E",scope:{controlName:"@name",labelName:"@label",controlValue:"@default"},controller:function(e){e.selectizeOptions=[],e.selectizeConfig={delimiter:"|",create:function(e){return{value:e,text:e}}}},require:"^agDashboard",template:'<B>{{labelName}} : </B><div style="display: inline-block; width: 20%;"><selectize config="selectizeConfig" options="selectizeOptions" ng-model="controlValue"></div>',link:function(e,a,r,n){var i=r.key;if(i){var s=t.getDropdownOptions(i);s.success(function(e,t,r,n){if(e&&e[i]){var s;for(var o in e)s=e[o];var l=a.find("selectize")[0].selectize;for(var o in s){var c=s[o];l.addOption({text:c,value:c})}l.refreshOptions(!1)}}).error(function(e,t,a,r){console.log("Error in retrieving tags")})}n.updateControl(e.controlName,e.controlValue,"agDropdown"),e.$watch("controlValue",function(t,a){n.updateControl(e.controlName,t,"agDropdown")})}}}])},function(e,t){angular.module("argus.directives.controls.submit",[]).directive("agSubmit",["$http",function(e){return{restrict:"E",scope:{controlName:"@name",elemId:"@id",cssName:"@class",style:"@style",size:"@size"},require:"^agDashboard",template:"",link:function(t,a,r,n){var i="Submit";a.text()&&a.text().length>0&&(i=a.text()),a.html("<button id="+t.elemId+' class="btn btn-primary btn-md '+t.cssName+'" size='+t.size+" style="+t.style+">"+i+"</button>"),a.on("click",function(){e.pendingRequests=[],n.broadcastEvent(n.getSubmitBtnEventName(),n.getAllControls())})}}}])},function(e,t){angular.module("argus.directives.controls.text",[]).directive("agText",["CONFIG","$routeParams",function(e,t){return{restrict:"EA",scope:{controlName:"@name",labelName:"@label",controlValue:"@default",elemId:"@id",cssName:"@class",style:"@style",size:"@size"},controller:function(e){e.ctrlVal=e.controlValue;for(var a in t)a==e.controlName&&(e.ctrlVal=t[a])},require:"^agDashboard",template:'<strong>{{labelName}} </strong><input id="{{elemId}}" type="text" class="{{cssName}}" size="{{size}}" style="{{style}}" ng-model="ctrlVal">',link:function(e,t,a,r){r.updateControl(e.controlName,e.ctrlVal,"agText"),e.$watch("ctrlVal",function(t,a){r.updateControl(e.controlName,t,"agText",!0)})}}}])},function(e,t){angular.module("argus.directives.dashboardResource",[]).directive("agDashboardResource",["DashboardService","$sce","$compile","$rootScope","$timeout",function(e,t,a,r,n){return{restrict:"E",scope:!1,link:function(r,n,i){var s;s=i.id&&i.id>0?i.id:r.dashboardId,e.getDashboardById(s).success(function(e){n.html("<div>"+t.trustAsHtml(e.content)+"</div>"),a(n.contents())(r)})}}}])},function(e,t){angular.module("argus.directives.headerMenu",[]).directive("headerMenu",["Auth",function(e){"use strict";return{restrict:"E",templateUrl:"js/templates/headerMenu.html",scope:{},controller:["$rootScope","$scope",function(t,a){t.$on("$routeChangeSuccess",function(e,t,r){a.activeTab=t.$$route?t.$$route.activeTab:""}),a.isLoggedIn=function(){return e.isLoggedIn()},a.currentUser=function(){return e.getUsername()},a.logout=function(){e.logout()}}],link:function(e,t,a){}}}])},function(e,t,a){"use strict";angular.module("argus.directives").directive("tableList",function(){return{restrict:"E",templateUrl:"js/templates/tableList.html",scope:{colName:"=",properties:"=",loaded:"=",dataSet:"=data",addItem:"&",delete:"&",enable:"&",refreshList:"&"},controller:["$scope","InputTracker","Auth",function(e,t,a){function r(){e.start=(e.currentPage-1)*e.itemsPerPage+1;var t=e.start+e.itemsPerPage-1;e.dataSet&&(e.end=t<e.dataSet.length?t:e.dataSet.length)}e.itemsPerPageOptions=[5,10,15,25,50,100,200];var n=e.properties.type+"-itemsPerPage";e.itemsPerPage=t.getDefaultValue(n,e.itemsPerPageOptions[1]),e.$watch("itemsPerPage",function(a){t.updateDefaultValue(n,e.itemsPerPageOptions[1],a),r()});var i=e.properties.type+"-searchText";e.searchText=t.getDefaultValue(i,""),e.$watch("searchText",function(e){t.updateDefaultValue(i,"",e)});var s=e.properties.type+"-currentPage";e.currentPage=t.getDefaultValue(s,1),e.$watch("currentPage",function(e){t.updateDefaultValue(s,1,e),r()});var o=e.properties.type+"-sortKey";e.sortKey=t.getDefaultValue(o,"modifiedDate");var l=e.properties.type+"-sortReverse";e.reverse=t.getDefaultValue(l,!0),e.sort=function(a){e.sortKey===a?(e.reverse=!e.reverse,t.updateDefaultValue(l,!0,e.reverse)):(e.sortKey=a,t.updateDefaultValue(o,"modifiedDate",e.sortKey))},e.$watch("dataSet.length",function(){r()}),e.deleteItem=function(t){e.delete()(t)},e.isDisabled=a.isDisabled,e.enableItem=function(t,a){e.enable()(t,a)}}]}})},function(e,t){angular.module("argus.services.auth",[]).factory("Auth",["$resource","$location","CONFIG","growl","Storage",function(e,t,a,r,n){return{login:function(i,s){var o={username:i,password:s};e(a.wsUrl+"auth/login",{},{}).save(o,function(e){n.set("user",e);var a=n.get("target");t.path(null===a||"/login"===a?"/":a)},function(e){n.reset(),r.error("Login failed")})},logout:function(){n.reset(),e(a.wsUrl+"auth/logout",{},{}).get({},function(e){r.info("You are now logged out"),t.path("/login")},function(e){r.error("Logout failed")})},setTarget:function(e){n.set("target",e)},getTarget:function(){return n.get("target")},remoteUser:function(){return n.get("user")},getUsername:function(){var e=this.remoteUser();return e?e.userName:null},isLoggedIn:function(){return null!==this.remoteUser()},isPrivileged:function(){var e=this.remoteUser();return e?e.privileged:null},isDisabled:function(e){var t=n.get("user");return!(t&&(t.privileged||t.userName===e.ownerName))}}}])},function(e,t,a){"use strict";angular.module("argus.services.breadcrumbs",[]).factory("breadcrumbs",["$rootScope","$location",function(e,t){var a=[],r={};return e.$on("$routeChangeSuccess",function(e,r){var n,i=t.absUrl().substr(0,t.absUrl().lastIndexOf("#")),s=t.path().split("/"),o=[],l=function(e){return i+"#/"+s.slice(0,e+1).join("/")};for(s.shift(),n=0;n<s.length;n++)o.push({name:s[n],path:l(n)});a=o}),r.getAll=function(){return a},r.getFirst=function(){return a[0]||{}},r}])},function(e,t){angular.module("argus.services.charts.options",[]).service("ChartOptionService",["UtilService",function(e){"use strict";var t={setCustomOptions:function(t,a){for(var r in a){var n=a[r].name,i=a[r].value,s=e.constructObjectTree(n,i);e.copyProperties(s,t)}return t},getOptionsByChartType:function(e,t,a){var r=e?angular.copy(e):{};return r.legend={enabled:!0,maxHeight:62,itemStyle:{fontWeight:"normal",fontSize:"10px"},navigation:{style:{fontWeight:"normal",fontSize:"10px"}}},r.credits={enabled:!1},r.rangeSelector={selected:1,inputEnabled:!1},r.xAxis={type:"datetime",ordinal:!1},r.lang={loading:"",noData:"No Data to Display"},r.loading={labelStyle:{top:"25%",backgroundImage:'url("img/ajax-loader.gif")',backgroundSize:"80px 80px",backgroundRepeat:"no-repeat",display:"inline-block",width:"80px",height:"80px",backgroundColor:"#FFF"}},t&&"AREA"===t.toUpperCase()?(r.plotOptions={series:{animation:!1}},r.chart={animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5,type:"area"}):t&&"STACKAREA"===t.toUpperCase()?(r.plotOptions={area:{stacking:"normal",dataGrouping:{enabled:!0},animation:!1,marker:{enabled:!1}}},r.chart={animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5,type:"area"}):(r.plotOptions={series:{animation:!1}},r.chart={animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5}),a&&(r.legend.enabled=!1,
r.rangeSelector.enabled=!1,r.scrollbar={enabled:!1},r.navigator={enabled:!1},r.chart.height="120",r.chart.borderWidth=0,r.lang={loading:"Loading..."},r.loading={}),r}};return t}])},function(e,t){angular.module("argus.services.charts.rendering",[]).service("ChartRenderingService",[function(){"use strict";var e={getChart:function(e,t){if(e){$("#"+e).highcharts("StockChart",t);var a=$("#"+e).highcharts("StockChart");return a}},setChartContainer:function(e,t,a){e&&t&&e.prepend("<div id="+t+' class="chartContainer '+a+'"></div>')},loadChart:function(e,t){var a=this.getChart(e,t);a&&this.loading(a,!0)},loading:function(e,t){e&&(t?(e.showLoading(),e.hideNoData()):(e.hideLoading(),e.hasData()||e.showNoData()))},displayChart:function(e,t){var a=this.getChart(e);a&&this.loading(a,!1)},updateIndicatorStatus:function(e,t){e&&t&&(t<e.lo?$("#"+e.name+"-status").removeClass("red orange green").addClass("red"):t>e.lo&&t<e.hi?$("#"+e.name+"-status").removeClass("red orange green").addClass("orange"):t>e.hi&&$("#"+e.name+"-status").removeClass("red orange green").addClass("green"))}};return e}])},function(e,t){angular.module("argus.services.charts.tools",[]).service("ChartToolService",[function(){"use strict";var e={getTimeAxis:function(e){for(var t=["12AM","1AM","2AM","3AM","4AM","5AM","6AM","7AM","8AM","9AM","10AM","11AM","12PM","1PM","2PM","3PM","4PM","5PM","6PM","7PM","8PM","9PM","10PM","11PM"],a=[],r=new Date(e.begin).getHours(),n=0;n<e.span;n++)a.push(t[(r+n)%24]);return a.push("<b><i>Average</i></b>"),a}};return e}])},function(e,t,a){"use strict";angular.module("argus.services.charts.dataProcessing",[]).service("ChartDataProcessingService",["ChartOptionService","Annotations","JsonFlattenService",function(e,t,a){function r(e){var t=[];if(e)for(var a=0;a<e.length;a++){var r=[];for(var i in e[a].datapoints){var s=parseInt(i);if(null!==e[a].datapoints[i]){var o=parseFloat(e[a].datapoints[i]);r.push([s,o])}}t.push({name:n(e[a]),data:r})}else t.push({name:"result",data:[]});return t}function n(e){var t=e.scope,a=e.metric,r=i(e.tags);return t+":"+a+r}function i(e){var t="";if(e){var a="";for(var r in e)e.hasOwnProperty(r)&&(a+=r+"="+e[r]+",");a.length&&(t+="{"+a.substring(0,a.length-1)+"}")}return t}function s(e){var t;if(e){t={type:"flags"},t.data=[];for(var a=0,r=0;r<e.length;r++){var n=e[r];t.data.push({x:n.timestamp,title:"A",text:o(n.fields),flagID:"_Flag"+a}),a++}}else t=null;return t}function o(e){var t="";if(e)for(var a in e)e.hasOwnProperty(a)&&(t+=a+": "+e[a]+"<br/>");return t}var l={getLastDataPoint:function(e){if(e)return e[Object.keys(e).sort().reverse()[0]]},getMetricSpecificOptionsInArray:function(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push({name:a,value:e[a]});return t},augmentExpressionWithControlsData:function(e,t){var a=e;for(var r in t){var n=t[r].name,i=t[r].value,s=t[r].type;if("agDate"===s){i=isNaN(Date.parse(i))?i:Date.parse(i),"string"==typeof i&&i.indexOf("GMT")>=0&&(i=i.replace("GMT","").trim()),null!==a.match(new RegExp("\\$"+n+"\\$","g"))&&(a=a.replace(new RegExp("\\$"+n+"\\$","g"),i));var o=null;if(null!==(o=a.match(new RegExp("\\$"+n+"\\-\\d+[smhd]\\$","g"))))i=this.modifyControlValue(i,o[0]),a=a.replace(new RegExp("\\$"+n+"\\-\\d+[smhd]\\$","g"),i);else if(null!==(o=a.match(new RegExp("\\$"+n+"\\-\\$[^\\$]*\\$\\$","g")))){o=o[0].substring(1,o[0].length-1);var l=o.match(/\$.*\$/)[0];l=l.substring(1,l.length-1);var c=this.getControlValueFromName(t,l);i=this.modifyControlValue(i,"-"+c),a=a.replace(new RegExp("\\$"+n+"\\-\\$[^\\$]*\\$\\$","g"),i)}}else i=void 0===i?"":i,a=a.replace(new RegExp("\\$"+n+"\\$","g"),i)}return a=a.replace(/(\r\n|\n|\r|\s+)/gm,"")},getControlValueFromName:function(e,t){for(var a in e)if(t===e[a].name)return e[a].value;return null},modifyControlValue:function(e,t){var a=t.match(/\-\d+[smdh]/)[0],r=this.getValue(a);return isNaN(e)?(e=this.getValue(e),"-"+(e+r)+"s"):e-1e3*r},getValue:function(e){e=e.substring(1);var t=e.substring(0,e.length-1),a=e.substring(e.length-1),r="invalid";switch(a){case"s":r=parseFloat(t);break;case"m":r=60*parseFloat(t);break;case"h":r=3600*parseFloat(t);break;case"d":r=24*parseFloat(t)*3600;break;default:console.log("Invalid time unit used.")}return r},processMetricData:function(e,t){if(e){var r=[],n=[],i=[],s=a.unflatten(e.options);for(var o in e.metrics)if(e.metrics.hasOwnProperty(o)){var l=e.metrics[o],c=l.expression,u=l.metricSpecificOptions,d=this.augmentExpressionWithControlsData(c,t);if(d.length>0){var g={};g.expression=d,g.name=l.name,g.color=l.color,g.metricSpecificOptions=this.getMetricSpecificOptionsInArray(u),n.push(g)}}for(var o in e.annotations)if(e.annotations.hasOwnProperty(o)){var d=this.augmentExpressionWithControlsData(e.annotations[o],t);d.length>0&&i.push(d)}return n.length>0?r={updatedMetricList:n,updatedAnnotationList:i,updatedOptionList:s}:void 0}},copySeriesDataNSetOptions:function(t,a){var r=[];if(t)for(var i=0;i<t.length;i++){var s=[];for(var o in t[i].datapoints){var l=parseInt(o);if(null!==t[i].datapoints[o]){var c=parseFloat(t[i].datapoints[o]);s.push([l,c])}}var u=a.name?a.name:n(t[i]),d=a.color?a.color:null,g={name:u,color:d,data:s},h=e.setCustomOptions(g,a.metricSpecificOptions);r.push(h)}else r.push({name:"result",data:[]});return r},populateAnnotations:function(e,t){if(e&&e.length>0&&t)for(var a=0;a<e.length;a++)this.addAlertFlag(e[a],t)},addAlertFlag:function(e,a){t.query({expression:e},function(e){if(e&&e.length>0){var t=n(e[0]),r=s(e);r.linkedTo=t;for(var i=0;i<a.series.length;i++)if(a.series[i].name==t){r.color=a.series[i].color;break}a.addSeries(r)}},function(e){console.log("no data found",e.data.message)})},getDatapointRange:function(e){var t={start:Number.MAX_VALUE,end:Number.MIN_VALUE};for(var a in e)e.hasOwnProperty(a)&&(a<t.start&&(t.start=a),a>t.end&&(t.end=a));return t},getAlertFlagExpression:function(e){if(e&&e.datapoints){var t=this.getDatapointRange(e.datapoints),a=e.scope,r=e.metric,n=e.tags,s=t.start+":"+t.end+":"+a+":"+r;return s+=i(n),s+=":ALERT"}return null},copySeries:r,createSeriesName:n,copyFlagSeries:s};return l}])},function(e,t,a){"use strict";angular.module("argus.services.charts.dateHandler",[]).service("DateHandlerService",function(){this.timeProcessingHelper=function(e){var t;if("-"===e[0]){e=e.toLowerCase().trim();var a=parseInt(e.substring(1,e.length-1)),r=e[e.length-1];switch(t=new Date,r){case"s":t=t.setSeconds(t.getSeconds()-a);break;case"m":t=t.setMinutes(t.getMinutes()-a);break;case"h":t=t.setHours(t.getHours()-a);break;case"d":t=t.setDate(t.getDate()-a)}return new Date(t)}return t=new Date(e),"Invalid Date"===t.toString()?new Date:t},this.GMTVerifier=function(e){return e.indexOf("-")!==-1||e.indexOf("GMT")!==-1},this.getStartTimestamp=function(e){var t=e.map(function(e){return e.data[0][0]});return Math.min.apply(null,t)},this.getEndTimestamp=function(e){var t=e.map(function(e){return e.data[e.data.length-1][0]});return Math.max.apply(null,t)}})},function(e,t){angular.module("argus.services").service("Controls",["$routeParams","$location",function(e,t){this.updateControlValue=function(t,a){for(var r in e)if(r==t)return e[r]},this.getUrl=function(e){for(var t="",a=0;a<e.length;a++)t+=e[a].name+"="+e[a].value,a<e.length-1&&(t+="&");return t}}])},function(e,t,a){"use strict";angular.module("argus.services.dashboard",[]).service("DashboardService",["$filter","$compile","$resource","CONFIG","VIEWELEMENT","Metrics","$sce","$http","Annotations","growl",function(e,t,a,r,n,i,s,o,l,c){function u(e,t){for(var a in e)if(t===e[a].name)return e[a].value;return null}function d(e,t){var a=t.match(/\-\d+[smdh]/)[0],r=g(a);return isNaN(e)?(e=g(e),"-"+(e+r)+"s"):e-1e3*r}function g(e){e=e.substring(1);var t=e.substring(0,e.length-1),a=e.substring(e.length-1),r="invalid";switch(a){case"s":r=parseFloat(t);break;case"m":r=60*parseFloat(t);break;case"h":r=3600*parseFloat(t);break;case"d":r=24*parseFloat(t)*3600;break;default:console.log("Invalid time unit used.")}return r}function h(e,t,a,n,i,s,o){$("#"+n).empty(),$("#"+n).show();var l=!!i.smallchart,c=i.type?i.type:"LINE",u=O(r,c,l);m(u,a),$("#"+n).highcharts("StockChart",u);var d=$("#"+n).highcharts("StockChart");d.showLoading(),d.hideNoData();var g=[],h={};h.totalCount=e.length;for(var p=0;p<e.length;p++){e[p].expression,e[p].metricSpecificOptions;f(e[p],u,g,n,i,t,h)}}function f(e,t,a,n,i,s,l){o({method:"GET",url:r.wsUrl+"metrics",params:{expression:e.expression}}).success(function(r,o,u,d){if(r&&r.length>0){if(i.smallchart){var g=Object.keys(r[0].datapoints).sort().reverse()[0];g=r[0].datapoints[g],I(i,g)}var h=p(r,e);Array.prototype.push.apply(a,h)}else c.info("No data found for the metric expression: "+JSON.stringify(e.expression));l.totalCount=l.totalCount-1,0==l.totalCount&&v(n,t,a,s)}).error(function(e,r,i,o){c.error(e.message),l.totalCount=l.totalCount-1,0==l.totalCount&&v(n,t,a,s)})}function p(e,t){var a=[];if(e)for(var r=0;r<e.length;r++){var n=[];for(var i in e[r].datapoints){var s=parseInt(i);if(null!=e[r].datapoints[i]){var o=parseFloat(e[r].datapoints[i]);n.push([s,o])}}var l=t.name?t.name:C(e[r]),c=t.color?t.color:null,u={name:l,color:c,data:n},d=m(u,t.metricSpecificOptions);a.push(d)}else a.push({name:"result",data:[]});return a}function m(e,t){for(var a in t){var r=t[a].name,n=t[a].value,i=V(r,n);R(i,e)}return e}function v(e,t,a,r){t.series=a,$("#"+e).highcharts("StockChart",t);var n=$("#"+e).highcharts("StockChart");n&&n.hideLoading(),n&&!n.hasData()&&n.showNoData(),b(r,n)}function b(e,t){if(e&&e.length>0&&t)for(var a=0;a<e.length;a++)y(e[a],t)}function y(e,t){l.query({expression:e},function(e){if(e&&e.length>0){var a=C(e[0]),r=E(e);r.linkedTo=a;for(var n=0;n<t.series.length;n++)if(t.series[n].name==a){r.color=t.series[n].color;break}t.addSeries(r)}})}function x(e){for(var t=[],a=0;a<e.length;a++)t.push(e[a].expression);return t}function T(e,t){for(var a=e.map(G.bind(null,t)),r=0;r<e.length;r++)a[r].push(F(e[r]));for(var n=[],r=0;r<e.length;r++)for(var i=0;i<a[0].length;i++){var s=a[e.length-1-r][i]?Math.floor(a[e.length-1-r][i]):null;n.push([i,r,s])}return n}function w(e){var t=[];if(e)for(var a=0;a<e.length;a++){var r=[];for(var n in e[a].datapoints){var i=parseInt(n);if(null!=e[a].datapoints[n]){var s=parseFloat(e[a].datapoints[n]);r.push([i,s])}}t.push({name:C(e[a]),data:r})}else t.push({name:"result",data:[]});return t}function C(e){var t=e.scope,a=e.metric,r=D(e.tags);return t+":"+a+r}function D(e){var t="";if(e){var a="";for(var r in e)e.hasOwnProperty(r)&&(a+=r+"="+e[r]+",");a.length&&(t+="{",t+=a.substring(0,a.length-1),t+="}")}return t}function E(e){var t;if(e){t={type:"flags",shape:"circlepin",stackDistance:20,width:16,lineWidth:2},t.data=[];for(var a=0;a<e.length;a++){var r=e[a];t.data.push({x:r.timestamp,title:"A",text:S(r.fields)})}}else t=null;return t}function S(e){var t="";if(e)for(var a in e)e.hasOwnProperty(a)&&(t+=a+": "+e[a]+"<br/>");return t}function I(e,t){t<e.lo?$("#"+e.name+"-status").removeClass("red orange green").addClass("red"):t>e.lo&&t<e.hi?$("#"+e.name+"-status").removeClass("red orange green").addClass("orange"):t>e.hi&&$("#"+e.name+"-status").removeClass("red orange green").addClass("green")}function N(e,t,a,r,n,i){var s=i.type?i.type:"LINE";if(t&&t.length>0){var o=O(e,s);o.series=w(t),m(o,n),$("#"+a).highcharts("StockChart",o)}else $("#"+a).highcharts("StockChart",O(e,s));var l=$("#"+a).highcharts("StockChart");b(r,l)}function M(a,r,n,i){if(a&&a.length>0){var s={};for(var o in a){var l=a[o].datapoints;for(var c in l)s[c]||(s[c]=[])}var u=[{title:"timestamp",value:"Timestamp"}];for(var o in a){var l=a[o].datapoints;if(l){u.push({title:"value"+o,value:C(a[o])});for(var c in s){var d=s[c];l[c]?d.push(parseFloat(l[c])):d.push(void 0),s[c]=d}}}var g=[];for(var c in s){var h={timestamp:parseInt(c),date:e("date")(c,"medium")};for(var o in u)"timestamp"!==u[o].title&&(h[u[o].title]=s[c][o-1]);g.push(h)}var f={itemsPerPage:10,fillLastPage:!0};for(var o in i){var p=i[o];p.name&&p.value&&(f[p.name]=p.value)}r.tData=g,r.config=f;var m='<div style="overflow-x: scroll"><table class="table table-striped table-header-rotated" at-table at-paginated at-list="tData" at-config="config">';m+="<thead>",m+="<tr>";for(var o in u)m+='<th class="rotate-45" at-attribute="'+u[o].title+'"><div><span>'+u[o].value+"</span></div></th>";m+="</tr>",m+="</thead>",m+="<tbody>",m+="<tr>";for(var o in u)m+="timestamp"===u[o].title?'<td at-sortable at-attribute="'+u[o].title+'">{{ item.date }}</td>':'<td at-sortable at-attribute="'+u[o].title+'">{{ item.'+u[o].title+"}}</td>";m+="</tr>",m+="</tbody>",m+="</table></div>",m+='<at-pagination at-list="tData" at-config="config"></at-pagination>',$("#"+n).empty(),t($("#"+n).prepend(m))(r)}}function A(e,t,a,r,n){if(t&&t.length>0){var i=n.top?parseInt(n.top):t.length,s=L(e,i);t.sort(P),t=t.slice(0,Math.min(i,t.length));var o=t.map(C),l=U(t),c=k(l),u=T(t,l);s.series[0].data=u,s.xAxis.categories=c,s.yAxis.categories=o.reverse(),m(s,r),$("#"+a).highcharts(s)}else $("#"+a).highcharts("StockChart",O(e,"LINE"))}function O(e,t,a){var r=e?angular.copy(e):{};return r.legend={enabled:!0,maxHeight:62,itemStyle:{fontWeight:"normal",fontSize:"10px"},navigation:{style:{fontWeight:"normal",fontSize:"10px"}}},r.credits={enabled:!1},r.rangeSelector={selected:1,inputEnabled:!1},r.xAxis={type:"datetime",ordinal:!1},r.lang={loading:"",noData:"No Data to Display"},r.loading={labelStyle:{top:"25%",backgroundImage:'url("img/ajax-loader.gif")',backgroundSize:"80px 80px",backgroundRepeat:"no-repeat",display:"inline-block",width:"80px",height:"80px",backgroundColor:"#FFF"}},t&&"AREA"===t.toUpperCase()?(r.plotOptions={series:{animation:!1}},r.chart={animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5,type:"area"}):t&&"STACKAREA"===t.toUpperCase()?(r.plotOptions={area:{stacking:"normal",dataGrouping:{enabled:!0},animation:!1,marker:{enabled:!1}}},r.chart={animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5,type:"area"}):(r.plotOptions={series:{animation:!1}},r.chart={animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5}),a&&(r.legend.enabled=!1,r.rangeSelector.enabled=!1,r.scrollbar={enabled:!1},r.navigator={enabled:!1},r.chart.height="120",r.chart.borderWidth=0,r.lang={loading:"Loading..."},r.loading={}),r}function L(e,t){var a=e?angular.copy(e):{};return a.credits={enabled:!1},a.chart={type:"heatmap",marginTop:0,marginBottom:60,height:40*t},a.title={text:""},a.xAxis={categories:null},a.yAxis={categories:null,title:null,labels:{}},a.colorAxis={dataClasses:[{from:0,to:300,color:"#00FF00"},{from:300,to:400,color:"#FF8000"},{from:400,color:"#FF0040"}]},a.legend={enabled:!0},a.tooltip={enabled:!1},a.series=[{name:"",borderWidth:1,data:null,dataLabels:{enabled:!0,color:"black",style:{textShadow:"none",HcTextStroke:null}}}],a}function k(e){for(var t=["12AM","1AM","2AM","3AM","4AM","5AM","6AM","7AM","8AM","9AM","10AM","11AM","12PM","1PM","2PM","3PM","4PM","5PM","6PM","7PM","8PM","9PM","10PM","11PM"],a=[],r=new Date(e.begin).getHours(),n=0;n<e.span;n++)a.push(t[(r+n)%24]);return a.push("<b><i>Average</i></b>"),a}function P(e,t){return F(e)<F(t)?1:F(e)>F(t)?-1:0}function U(e){for(var t=9999999999999,a=0,r=0;r<e.length;r++)for(var n in e[r].datapoints)t=Math.min(t,parseInt(n)),a=Math.max(a,parseInt(n));var i=Math.floor(a/1e3/60/60)-Math.floor(t/1e3/60/60)+1;return{begin:t,end:a,span:i}}function F(e){var t=0,a=0;for(var r in e.datapoints)t+=parseInt(e.datapoints[r]),a+=1;return a>0?t/a:0}function G(e,t){var a=Array.apply(null,Array(e.span)).map(Number.prototype.valueOf,0),r=Array.apply(null,Array(e.span)).map(Number.prototype.valueOf,0),n=Math.floor(e.begin/1e3/60/60);for(var i in t.datapoints){var s=Math.floor(parseInt(i)/1e3/60/60);a[s-n]+=parseInt(t.datapoints[i]),r[s-n]+=1}for(var o=[],l=0;l<e.span;l++)r[l]>0?o.push(a[l]/r[l]):o.push(null);return o}function R(e,t){for(var a in e)e.hasOwnProperty(a)&&(!t[a]||"string"==typeof e[a]||e[a]instanceof String?t[a]=e[a]:R(e[a],t[a]))}function V(e,t){var a={},r=e.indexOf(".");if(r==-1)return a[e]=B(t),a;var n=e.substring(0,r);return a[n]=V(e.substring(r+1),t),a}function B(e){return e instanceof Object||0==e.length?e:"true"==e||"false"!=e&&(isNaN(e)?e:parseInt(e))}this.updateIndicatorStatus=I,this.getDashboardById=function(e){return o.get(r.wsUrl+"dashboards/"+e)},this.getMetricData=function(e){if(e){var t=o({method:"GET",url:r.wsUrl+"metrics",params:{expression:e}}).success(function(t,a,r,n){return t&&t.length>0?t[0]:void c.info("No data found for the metric expression: "+JSON.stringify(e))}).error(function(e,t,a,r){c.error(e.message)});return t}},this.augmentExpressionWithControlsData=function(e,t,a){var r=t;for(var n in a){var i=a[n].name,s=a[n].value,o=a[n].type;if("agDate"===o){s=isNaN(Date.parse(s))?s:Date.parse(s),"string"==typeof s&&s.indexOf("GMT")>=0&&(s=s.replace("GMT","").trim()),null!==r.match(new RegExp("\\$"+i+"\\$","g"))&&(r=r.replace(new RegExp("\\$"+i+"\\$","g"),s));var l=null;if(null!=(l=r.match(new RegExp("\\$"+i+"\\-\\d+[smhd]\\$","g"))))s=d(s,l[0]),r=r.replace(new RegExp("\\$"+i+"\\-\\d+[smhd]\\$","g"),s);else if(null!=(l=r.match(new RegExp("\\$"+i+"\\-\\$.*\\$\\$","g")))){l=l[0].substring(1,l[0].length-1);var c=l.match(/\$.*\$/)[0];c=c.substring(1,c.length-1);var g=u(a,c);s=d(s,"-"+g),r=r.replace(new RegExp("\\$"+i+"\\-\\$.*\\$\\$","g"),s)}}else s=void 0==s?"":s,r=r.replace(new RegExp("\\$"+i+"\\$","g"),s)}return r=r.replace(/(\r\n|\n|\r|\s+)/gm,"")},this.buildViewElement=function(e,t,a,r,n,i,s,o){function l(t,r){var i=[],o=[],l=[];for(var d in e.metrics)if(e.metrics.hasOwnProperty(d)){var g=e.metrics[d],h=g.expression,f=g.metricSpecificOptions,p=s.augmentExpressionWithControlsData(t,h,r);if(p.length>0){var m={};m.expression=p,m.name=g.name,m.color=g.color,m.metricSpecificOptions=c(f),i.push(m)}}for(var d in e.annotations)if(e.annotations.hasOwnProperty(d)){var p=s.augmentExpressionWithControlsData(t,e.annotations[d],r);p.length>0&&o.push(p)}for(var d in e.options)e.options.hasOwnProperty(d)&&l.push({name:d,value:e.options[d]});i.length>0&&s.populateView(i,o,l,u,a,n,e)}function c(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push({name:a,value:e[a]});return t}var u="element_"+n+i,d=a.smallchart?'class="smallChart"':"";t.prepend("<div id="+u+" "+d+"></div>"),e.$on(r.getSubmitBtnEventName(),function(e,t){console.log(r.getSubmitBtnEventName()+" event received."),l(e,t)})},this.populateView=function(e,t,a,i,s,l,u){if(e||i){if(!e)return c.error("Valid metric expressions are required to display the chart/table."),void $("#"+i).hide();if(l===n.chart)h(e,t,a,i,s,l,u);else{var d=x(e);o({method:"GET",url:r.wsUrl+"metrics",params:{expression:d}}).success(function(e,r,o,g){e&&e.length>0?($("#"+i).show(),l===n.heatmap?A({},e,i,a,s):l===n.table&&M(e,u,i,a)):(N({},e,i,t,a,s),c.info("No data found for the metric expressions: "+JSON.stringify(d)))}).error(function(e,t,a,r){c.error(e.message),$("#"+i).hide()})}}}}])},function(e,t,a){"use strict";angular.module("argus.services.downloadHelper",[]).service("DownloadHelper",function(){this.downloadFile=function(e,t){var a=window.URL.createObjectURL(new Blob([e])),r=document.createElement("a");r.href=a,r.download=t,r.target="_blank",r.click()}})},function(e,t){angular.module("argus.services.alerts",[]).factory("Alerts",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"alerts/:alertId",{},{query:{method:"GET",params:{alertId:""},isArray:!0},update:{method:"PUT"},getMeta:{method:"GET",url:t.wsUrl+"alerts/meta?shared=true",isArray:!0},getUsers:{method:"GET",url:t.wsUrl+"alerts/meta?shared=false",isArray:!0}})}])},function(e,t){angular.module("argus.services.annotations",[]).factory("Annotations",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"annotations",{},{query:{method:"GET",isArray:!0}})}])},function(e,t){angular.module("argus.services.asyncMetrics",["ngResource"]).factory("AsyncMetrics",["$http","CONFIG",function(e,t){return{create:function(a){return e({url:t.wsUrl+"metrics/batch",method:"GET",params:a})}}}])},function(e,t){angular.module("argus.services.batches",["ngResource"]).factory("Batches",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"batches/:batchId",{},{query:{method:"GET",params:{batchId:""}}})}])},function(e,t){angular.module("argus.services.dashboards",[]).factory("Dashboards",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"dashboards/:dashboardId",{},{query:{method:"GET",params:{dashboardId:""},isArray:!0},update:{method:"PUT"},getMeta:{method:"GET",url:t.wsUrl+"dashboards/meta",isArray:!0}})}])},function(e,t){angular.module("argus.services.history",[]).factory("History",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"audit/entity/:id",{id:"@id",limit:"20"},{})}])},function(e,t){angular.module("argus.services.jobexecutiondetails",[]).factory("JobExecutionDetails",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"history/job/:id",{id:"@id",limit:"20"},{})}])},function(e,t){angular.module("argus.services.metrics",[]).factory("Metrics",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"metrics",{},{query:{method:"GET",isArray:!0},downloadCSV:{method:"GET",headers:{Accept:"application/ms-excel"},transformResponse:[function(e){return[e]}],isArray:!0}})}])},function(e,t){angular.module("argus.services.namespace",[]).factory("Namespace",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"namespace/:namespaceId",{},{update:{method:"PUT"}})}])},function(e,t){angular.module("argus.services.notifications",[]).factory("Notifications",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"alerts/:alertId/notifications/:notificationId",{},{query:{method:"GET",params:{notificationId:""},isArray:!0},save:{method:"POST",isArray:!0},update:{method:"PUT"}})}])},function(e,t){angular.module("argus.services.admin.reinstateuser",["ngResource"]).factory("ReinstateUser",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"management/reinstateuser",{},{update:{method:"PUT"}})}])},function(e,t){angular.module("argus.services.triggers",[]).factory("Triggers",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"alerts/:alertId/triggers/:triggerId",{},{query:{method:"GET",params:{triggerId:""},isArray:!0},save:{method:"POST",isArray:!0},update:{method:"PUT"}})}])},function(e,t){angular.module("argus.services.triggersmap",[]).factory("TriggersMap",["$resource","CONFIG",function(e,t){return e(t.wsUrl+"alerts/:alertId/notifications/:notificationId/triggers/:triggerId",{},{map:{method:"POST"},unmap:{method:"DELETE"}})}])},function(e,t,a){"use strict";angular.module("argus.services.inputTracker",[]).service("InputTracker",["Storage",function(e){this.getDefaultValue=function(t,a){return null===e.get(t)?a:e.get(t)},this.updateDefaultValue=function(t,a,r){var n=null===r?a:r;e.set(t,n)}}])},function(e,t,a){"use strict";angular.module("argus.services.jsonFlatten",[]).service("JsonFlattenService",function(){this.unflatten=function(e){if(Object(e)!==e||Array.isArray(e))return e;var t=/\.?([^.\[\]]+)|\[(\d+)\]/g,a={};for(var r in e){for(var n,i=a,s="";n=t.exec(r);)i=i[s]||(i[s]=n[2]?[]:{}),s=n[2]||n[1];i[s]=e[r]}return a[""]||a},this.flatten=function(e){function t(e,r){if(Object(e)!==e)a[r]=e;else if(Array.isArray(e)){for(var n=0,i=e.length;n<i;n++)t(e[n],r+"["+n+"]");0==i&&(a[r]=[])}else{var s=!0;for(var o in e)s=!1,t(e[o],r?r+"."+o:o);s&&r&&(a[r]={})}}var a={};return t(e,""),a}})},function(e,t){angular.module("argus.services.search",[]).service("SearchService",["$q","$http","CONFIG",function(e,t,a){this.search=function(e){if(e){var r=t({method:"GET",url:a.wsUrl+"discover/metrics/schemarecords",params:e,timeout:3e4});return r}},this.processResponse=function(e){return e.data}}])},function(e,t){angular.module("argus.services.storage",[]).factory("Storage",["$rootScope","$localStorage",function(e,t){return e.storage=t,{set:function(t,a){e.storage[t]=a},get:function(t){var a=e.storage[t];return angular.isDefined(a)?a:null},clear:function(t){delete e.storage[t]},reset:function(){e.storage.$reset()}}}])},function(e,t,a){"use strict";angular.module("argus.services.tableListService",[]).service("TableListService",["$sessionStorage",function(e){this.deleteItemFromListHelper=function(e,t){return e.filter(function(e){return e.id!==t.id})},this.getListUnderTab=function(e,t,a){var r,n=[],i=e.length;if(t)for(r=0;r<i;r++)e[r].shared&&n.push(e[r]);else for(r=0;r<i;r++)e[r].ownerName===a&&n.push(e[r]);return n},this.addItemToTableList=function(t,a,r,n){return e[a].cachedData.push(r),r.shared&&t.sharedList.push(r),r.ownerName===n&&t.usersList.push(r),t},this.deleteItemFromTableList=function(t,a,r,n){return e[a].cachedData=this.deleteItemFromListHelper(e[a].cachedData,r),r.shared&&(t.sharedList=this.deleteItemFromListHelper(t.sharedList,r)),r.ownerName===n&&(t.usersList=this.deleteItemFromListHelper(t.usersList,r)),t}}])},function(e,t){angular.module("argus.services.tags",[]).service("Tags",["CONFIG","$http","$q",function(e,t,a){this.getDropdownOptions=function(a){var r=t({method:"GET",url:e.wsUrl+"schema/tags",params:{tagk:a}});return r}}])},function(e,t){angular.module("argus.services.interceptor",[]).factory("UnauthorizedInterceptor",["$q","$location","Storage",function(e,t,a){return{responseError:function(r){if(401===r.status||0===r.status){var n=r.config.url,i="/login";if(n.indexOf(i,n.length-i.length)===-1){var s=a.get("target");return a.reset(),a.set("target",s),void t.path("/login")}}return e.reject(r)}}}])},function(e,t){angular.module("argus.services.utils",[]).service("UtilService",[function(){"use strict";var e={assignController:function(e){if(e)for(var t=0;t<e.length;t++)if(e[t])return e[t]},copyProperties:function(e,t){for(var a in e)e.hasOwnProperty(a)&&(!t[a]||"string"==typeof e[a]||e[a]instanceof String?t[a]=e[a]:copyProperties(e[a],t[a]))},constructObjectTree:function(e,t){var a={},r=e.indexOf(".");if(r==-1)return a[e]=this.getParsedValue(t),a;var n=e.substring(0,r);return a[n]=this.constructObjectTree(e.substring(r+1),t),a},getParsedValue:function(e){return e instanceof Object||0==e.length?e:"true"==e||"false"!=e&&(isNaN(e)?e:parseInt(e))}};return e}])},function(e,t){angular.module("argus.constants",[]).constant("VIEWELEMENT",{chart:"chart",heatmap:"heatmap",table:"table"}).constant("CHARTTYPE",{line:"line",area:"area"}).constant("BATCH_CHART_OPTIONS",{credits:{enabled:!1},rangeSelector:{selected:1,inputEnabled:!1},xAxis:{type:"datetime",ordinal:!1},lang:{noData:"No Data to Display"},legend:{enabled:!0,maxHeight:62,itemStyle:{fontWeight:"normal",fontSize:"10px"},navigation:{style:{fontWeight:"normal",fontSize:"10px"}}},plotOptions:{series:{animation:!1,connectNulls:!0},line:{gapSize:1.5}},chart:{animation:!1,borderWidth:1,borderColor:"lightGray",borderRadius:5}})},function(e,t){angular.module("argus.filters",[]).filter("isEmpty",function(){return function(e){return angular.equals({},e)}}).filter("duration",function(){return function(e){var t=Math.floor(e/1e3%60),a=Math.floor(e/6e4%60),r=e<864e5?Math.floor(e/36e5%24):Math.floor(e/36e5);return r=r<1?"":r+"h ",a=a<1?"":a+"m ",t=t<1?"":t+"s",""===t&&""===a&&""===r&&(t="0s"),r+a+t}}).filter("duration_fractional",function(){return function(e){var t=e,a=t%1e3;t=(t-a)/1e3;var r=t%60;t=(t-r)/60;var n=t%60,i=(t-n)/60;return i>0?Math.floor(10*e/36e5)/10+"h":n>0?Math.floor(10*e/6e4)/10+"m":e>10?Math.floor(e/10)/100+"s":e>0?Math.floor(e)+"ms":0}}).filter("bytes",function(){return function(e){if(void 0===e||null===e)return"n/a";if(0===e)return"0";var t=["B","KB","MB","GB","TB"],a=Math.floor(Math.log(e)/Math.log(1024)),r=Math.round(100*e/Math.pow(1024,a))/100;return r+" "+t[a]}}).filter("base10si",function(){return function(e){if(void 0===e||null===e)return"n/a";if(0===e)return"0";var t=["","K","M","G","T"],a=Math.floor(Math.log(e)/Math.log(1e3)),r=Math.round(100*e/Math.pow(1e3,a))/100;return r+" "+t[a]}}).filter("nullable_decimal",function(){return function(e){return void 0===e||null===e?"n/a":parseFloat(e).toFixed(2)}}).filter("_date_",function(){return function(e){return void 0===e||null===e||0===e?"n/a":moment(e).format("MMM Do, YYYY")}}).filter("_time_",function(){return function(e){return void 0===e||null===e||0===e?"n/a":moment(e).format("h:mm:ss a")}}).filter("_date_time_",function(){return function(e){return void 0===e||null===e||0===e?"n/a":moment(e).format("MMM Do, YYYY h:mm:ss a")}}).filter("_short_date_time_",function(){return function(e){return void 0===e||null===e||0===e?"n/a":moment(e).format("MMM Do")}}).filter("_date_time_from_timestamp_",function(){return function(e,t){var a=parseInt(e);if(isNaN(a))return"n/a";var r=moment(a),n="MMM Do, YYYY h:mm a",i=!0,s=!0,o=!0,l=!0;if(t){var c=parseInt(t);if(!isNaN(c)){var u=moment(c);r.year()==u.year()&&(s=!1),r.year()==u.year()&&r.date()==u.date()&&r.month()==u.month()&&(i=!1)}}var n=(i?"MMM Do":"")+(i&&s?", YYYY ":i?" ":"")+(o?"h":"")+(l?":mm":"")+(o||l?" a":"");return r.format(n)}}).filter("truncateString",function(){return function(e,t){return e&&e.length>t?e.substring(0,t)+"…":e}}).filter("capitalize",function(){return function(e,t){if(null!=e)return e=e.toLowerCase(),e.substring(0,1).toUpperCase()+e.substring(1)}}).filter("urlencode",function(){return window.encodeURIComponent}).filter("newline",function(){return function(e){if(e&&e.length>0){var t=e.replace(/</g,"&lt");return t=t.replace(/>/g,"&gt"),t=t.replace(/\n/g,"<br/>")}return""}}).filter("trustedhtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}])},function(e,t,a){"use strict";angular.module("argus",["ngRoute","ngAnimate","ngStorage","angular-growl","angularUtils.directives.dirPagination","angulartics","ui.bootstrap","ui.bootstrap.datetimepicker","argus.urlConfig","argus.config","argus.filters","argus.constants","argus.services","argus.controllers","argus.directives","argus.directives.breadcrumbs","argus.directives.confirm","argus.directives.dashboardResource","argus.directives.controls.dashboard","argus.directives.controls.date","argus.directives.controls.dropdown","argus.directives.controls.submit","argus.directives.controls.text","argus.directives.charts.chart","argus.directives.charts.lineChart","argus.directives.charts.flags","argus.directives.charts.heatmap","argus.directives.charts.metric","argus.directives.charts.option","argus.directives.charts.statusIndicator","argus.directives.charts.table","argus.directives.headerMenu"]).run(["$http","$templateCache",function(e,t){e.get("js/templates/breadcrumbs.html",{cache:t}),e.get("js/templates/login.html",{cache:t}),e.get("js/templates/alert-list.html",{cache:t}),e.get("js/templates/alert-detail.html",{cache:t}),e.get("js/templates/dashboard-list.html",{cache:t}),e.get("js/templates/dashboard-detail.html",{cache:t}),e.get("js/templates/viewmetrics.html",{cache:t}),e.get("js/templates/charts/topToolbar.html",{cache:t})}]),angular.module("argus.services",["argus.services.admin.reinstateuser","argus.services.alerts","argus.services.annotations","argus.services.asyncMetrics","argus.services.auth","argus.services.batches","argus.services.breadcrumbs","argus.services.charts.options","argus.services.charts.rendering","argus.services.charts.tools","argus.services.charts.dataProcessing","argus.services.charts.dateHandler","argus.services.dashboard","argus.services.dashboards","argus.services.history","argus.services.interceptor","argus.services.inputTracker","argus.services.jobexecutiondetails","argus.services.metrics","argus.services.namespace","argus.services.notifications","argus.services.search","argus.services.storage","argus.services.tags","argus.services.triggers","argus.services.triggersmap","argus.services.utils","argus.services.jsonFlatten","argus.services.tableListService","argus.services.downloadHelper"]),angular.module("argus.controllers",["argus.services","argus.controllers.about","argus.controllers.admin","argus.controllers.alerts","argus.controllers.alerts.detail","argus.controllers.batches","argus.controllers.dashboards","argus.controllers.dashboards.detail","argus.controllers.login","argus.controllers.main","argus.controllers.metricelements","argus.controllers.namespace","argus.controllers.viewelements","argus.controllers.viewMetrics"]),
angular.module("argus.directives",[]),angular.module("argus.filters",[]),a(1),a(0),a(68),a(69),a(2),a(3),a(4),a(5),a(6),a(7),a(8),a(9),a(10),a(11),a(12),a(13),a(14),a(37),a(38),a(44),a(45),a(60),a(62),a(63),a(65),a(66),a(67),a(61),a(64),a(46),a(39),a(40),a(41),a(42),a(43),a(47),a(49),a(48),a(50),a(51),a(52),a(53),a(54),a(55),a(56),a(57),a(58),a(59),a(35),a(36),a(20),a(34),a(29),a(30),a(31),a(32),a(33),a(21),a(24),a(22),a(23),a(25),a(26),a(27),a(28),a(15),a(19),a(16),a(18),a(17)}]);